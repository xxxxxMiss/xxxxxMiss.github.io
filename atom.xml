<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>青史成灰</title>
  
  <subtitle>Every journey begins with the first step</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://xxxxxmiss.github.io/"/>
  <updated>2018-12-02T11:30:06.169Z</updated>
  <id>https://xxxxxmiss.github.io/</id>
  
  <author>
    <name>xxxxxMiss</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>connect源码解读</title>
    <link href="https://xxxxxmiss.github.io/2018/11/27/connect/"/>
    <id>https://xxxxxmiss.github.io/2018/11/27/connect/</id>
    <published>2018-11-27T14:02:53.000Z</published>
    <updated>2018-12-02T11:30:06.169Z</updated>
    
    <content type="html"><![CDATA[<h2 id="connect-简介"><a href="#connect-简介" class="headerlink" title="connect 简介"></a>connect 简介</h2><blockquote><p>connect 是一款极简的 web 框架，串联各种中间件来处理请求。</p></blockquote><h2 id="API"><a href="#API" class="headerlink" title="API"></a>API</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// require module</span></div><div class="line"><span class="keyword">const</span> connect = <span class="built_in">require</span>(<span class="string">'connect'</span>)</div><div class="line"></div><div class="line"><span class="comment">// create app</span></div><div class="line"><span class="keyword">const</span> app = connect()</div></pre></td></tr></table></figure><h3 id="app-req-res-next"><a href="#app-req-res-next" class="headerlink" title="app(req, res[, next])"></a>app(req, res[, next])</h3><blockquote><p><code>app</code>本身也是一个函数，他是<code>app.handle</code>的一个别名。</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">module</span>.exports = createServer</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">createServer</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">app</span>(<span class="params">req, res, next</span>) </span>&#123;</div><div class="line">    app.handle(req, res, next)</div><div class="line">  &#125;</div><div class="line">  <span class="comment">// 将proto上的方法拷贝到app上</span></div><div class="line">  <span class="comment">// proto是一个对象，该对象上只有use, handle, listen三个方法</span></div><div class="line">  merge(app, proto)</div><div class="line">  <span class="comment">// 将EventEmitter原型链上的方法拷贝到app上</span></div><div class="line">  merge(app, EventEmitter.prototype)</div><div class="line">  app.route = <span class="string">'/'</span></div><div class="line">  <span class="comment">// 该stack属性就是用来存放所有的中间件</span></div><div class="line">  app.stack = []</div><div class="line">  <span class="comment">// 返回的是一个function，并且接收(req, res, next)形式的参数</span></div><div class="line">  <span class="comment">// 这样就可以将这个返回的函数传入到nodejs原生的http或者https的createServer中</span></div><div class="line">  <span class="comment">// 后面要解读的listen方法，默认使用http模块</span></div><div class="line">  <span class="comment">// 通过返回这种形式的函数，就可以在http或者https模块之间切换</span></div><div class="line">  <span class="keyword">return</span> app</div><div class="line">&#125;</div></pre></td></tr></table></figure><h3 id="app-listen-…"><a href="#app-listen-…" class="headerlink" title="app.listen([…])"></a>app.listen([…])</h3><blockquote><p>就是对 nodejs 中<code>http.Server#listen</code>方法一个简单的封装。</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">proto.listen = <span class="function"><span class="keyword">function</span> <span class="title">listen</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="comment">// 因为调用都是通过app.listen，所有此处的this就是app</span></div><div class="line">  <span class="comment">// 而上面已经介绍了app是一个接收(req, res, next)的函数</span></div><div class="line">  <span class="keyword">var</span> server = http.createServer(<span class="keyword">this</span>)</div><div class="line">  <span class="comment">// 调用server上的listen方法</span></div><div class="line">  <span class="keyword">return</span> server.listen.apply(server, <span class="built_in">arguments</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure><h3 id="app-use-fn"><a href="#app-use-fn" class="headerlink" title="app.use(fn)"></a>app.use(fn)</h3><blockquote><p>这个方法就是添加各种中间件到<code>app.stack</code>中。<br>还有一个类似的方法<code>app.use(route, fn)</code>，其实<code>app.use(fn)</code>可以看成是<code>app.use(&#39;/&#39;, fn)</code>。</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line">proto.use = <span class="function"><span class="keyword">function</span> <span class="title">use</span>(<span class="params">route, fn</span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> handle = fn</div><div class="line">  <span class="keyword">var</span> path = route</div><div class="line"></div><div class="line">  <span class="comment">// default route to '/'</span></div><div class="line">  <span class="comment">// 这个就是处理app.use(fn)的情况</span></div><div class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> route !== <span class="string">'string'</span>) &#123;</div><div class="line">    handle = route</div><div class="line">    path = <span class="string">'/'</span></div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">// wrap sub-apps</span></div><div class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> handle.handle === <span class="string">'function'</span>) &#123;</div><div class="line">    <span class="keyword">var</span> server = handle</div><div class="line">    server.route = path</div><div class="line">    handle = <span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>) </span>&#123;</div><div class="line">      server.handle(req, res, next)</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">// wrap vanilla http.Servers</span></div><div class="line">  <span class="comment">// 这种情况用来处理fn是一个http.Server实例，</span></div><div class="line">  <span class="comment">// 就是说你可以传入一个http.Server实例作为中间件</span></div><div class="line">  <span class="keyword">if</span> (handle <span class="keyword">instanceof</span> http.Server) &#123;</div><div class="line">    <span class="comment">// 因为http.Server继承了EventEmitter,所以有listeners方法</span></div><div class="line">    <span class="comment">// 取request事件中的第一个监听器作为中间件</span></div><div class="line">    handle = handle.listeners(<span class="string">'request'</span>)[<span class="number">0</span>]</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">// strip trailing slash</span></div><div class="line">  <span class="comment">// 当你请求的路径为`/path/name/`,就是末尾带有斜杆</span></div><div class="line">  <span class="comment">// 那么会剔除末尾的斜杆</span></div><div class="line">  <span class="comment">// 其实路径末尾带有斜杆，表示的是一个文件夹，</span></div><div class="line">  <span class="keyword">if</span> (path[path.length - <span class="number">1</span>] === <span class="string">'/'</span>) &#123;</div><div class="line">    path = path.slice(<span class="number">0</span>, <span class="number">-1</span>)</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">// add the middleware</span></div><div class="line">  debug(<span class="string">'use %s %s'</span>, path || <span class="string">'/'</span>, handle.name || <span class="string">'anonymous'</span>)</div><div class="line">  <span class="comment">// 将中间件和请求的路径添加到一个对象上，然后将该对象推入app.stack中</span></div><div class="line">  <span class="keyword">this</span>.stack.push(&#123; <span class="attr">route</span>: path, <span class="attr">handle</span>: handle &#125;)</div><div class="line"></div><div class="line">  <span class="comment">// 返回app，可以形成链式调用，如： app.use(fn).listen()</span></div><div class="line">  <span class="keyword">return</span> <span class="keyword">this</span></div><div class="line">&#125;</div></pre></td></tr></table></figure><h3 id="app-handle-req-res-out"><a href="#app-handle-req-res-out" class="headerlink" title="app.handle(req, res[, out])"></a>app.handle(req, res[, out])</h3><blockquote><p>这个方法用来处理服务器请求，模块导出的 app 内部就是调用该方法。</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div></pre></td><td class="code"><pre><div class="line">proto.handle = <span class="function"><span class="keyword">function</span> <span class="title">handle</span>(<span class="params">req, res, out</span>) </span>&#123;</div><div class="line">  <span class="comment">// 这个变量用来控制中间件是否已经全部结束</span></div><div class="line">  <span class="keyword">var</span> index = <span class="number">0</span></div><div class="line">  <span class="comment">// 得到协议+主机部分</span></div><div class="line">  <span class="comment">// getProtohost的解释看下面</span></div><div class="line">  <span class="keyword">var</span> protohost = getProtohost(req.url) || <span class="string">''</span></div><div class="line">  <span class="comment">// 要移除的route部分</span></div><div class="line">  <span class="keyword">var</span> removed = <span class="string">''</span></div><div class="line">  <span class="comment">// 是否在path的最前面添加过'/'的标记</span></div><div class="line">  <span class="keyword">var</span> slashAdded = <span class="literal">false</span></div><div class="line">  <span class="comment">// 拿到所有的中间件</span></div><div class="line">  <span class="keyword">var</span> stack = <span class="keyword">this</span>.stack</div><div class="line"></div><div class="line">  <span class="comment">// final function handler</span></div><div class="line">  <span class="comment">// 可以指定自己的最终处理函数（所有的中间件都执行完毕后调用）</span></div><div class="line">  <span class="comment">// 如果没有指定，那么使用`finalhandler`模块来处理</span></div><div class="line">  <span class="keyword">var</span> done =</div><div class="line">    out ||</div><div class="line">    finalhandler(req, res, &#123;</div><div class="line">      <span class="attr">env</span>: env,</div><div class="line">      <span class="attr">onerror</span>: logerror</div><div class="line">    &#125;)</div><div class="line"></div><div class="line">  <span class="comment">// store the original URL</span></div><div class="line">  <span class="comment">// 因为我们要对一些边缘情况的url做处理，</span></div><div class="line">  <span class="comment">// 所以此处会把请求原始的url挂载到req的originUrl上</span></div><div class="line">  req.originalUrl = req.originalUrl || req.url</div><div class="line"></div><div class="line">  <span class="comment">// 这个next方法就是每个中间件中最后一个参数next</span></div><div class="line">  <span class="comment">// 使用它来控制是否继续执行下一个中间件</span></div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">next</span>(<span class="params">err</span>) </span>&#123;</div><div class="line">    <span class="comment">// 如果手动添加过path部分前面的'/',</span></div><div class="line">    <span class="comment">// 那么此处先去掉前面的'/',并且将slashAdded标记重置为false</span></div><div class="line">    <span class="keyword">if</span> (slashAdded) &#123;</div><div class="line">      req.url = req.url.substr(<span class="number">1</span>)</div><div class="line">      slashAdded = <span class="literal">false</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// 表明有移除的部分</span></div><div class="line">    <span class="keyword">if</span> (removed.length !== <span class="number">0</span>) &#123;</div><div class="line">      <span class="comment">// 那么完整的url应该为protohost + removed + path（这一部分是去掉removed，剩下的部分）</span></div><div class="line">      req.url = protohost + removed + req.url.substr(protohost.length)</div><div class="line">      <span class="comment">// 将removed置空</span></div><div class="line">      removed = <span class="string">''</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// next callback</span></div><div class="line">    <span class="comment">// 每次调用next都会从stack中取出一个中间件</span></div><div class="line">    <span class="keyword">var</span> layer = stack[index++]</div><div class="line"></div><div class="line">    <span class="comment">// all done</span></div><div class="line">    <span class="comment">// 如果不存在，说明中间件已经全部执行完毕，</span></div><div class="line">    <span class="comment">// 那么执行最后的一个收尾操作</span></div><div class="line">    <span class="comment">// 你可以自定义收尾操作，没有定义就使用finalhandler这个模块来处理</span></div><div class="line">    <span class="keyword">if</span> (!layer) &#123;</div><div class="line">      defer(done, err)</div><div class="line">      <span class="keyword">return</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// route data</span></div><div class="line">    <span class="comment">// parseUrl是一个npm包，功能跟nodjs自带的url模块的parse方法一样，</span></div><div class="line">    <span class="comment">// 只不过加入了缓存处理，如果每次拿到相同的url就不在解析，直接返回缓存中的结果</span></div><div class="line">    <span class="comment">// 这个path是你请求的path</span></div><div class="line">    <span class="keyword">var</span> path = parseUrl(req).pathname || <span class="string">'/'</span></div><div class="line">    <span class="comment">// 这个route是你在调用app.use(route, fn)中的route</span></div><div class="line">    <span class="keyword">var</span> route = layer.route</div><div class="line"></div><div class="line">    <span class="comment">// skip this layer if the route doesn't match</span></div><div class="line">    <span class="comment">// 因为url是不区分大小写的,所以此处使用toLowerCase来统一处理</span></div><div class="line">    <span class="comment">// 如果route为：/blog，path为：/blog/post，</span></div><div class="line">    <span class="comment">// 这个时候app.use('/blog', fn)中的fn是会执行的</span></div><div class="line">    <span class="comment">// 此处用来处理path和route没有这种包含关系，那么跳过执行fn</span></div><div class="line">    <span class="keyword">if</span> (path.toLowerCase().substr(<span class="number">0</span>, route.length) !== route.toLowerCase()) &#123;</div><div class="line">      <span class="keyword">return</span> next(err)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// skip if route match does not border "/", ".", or end</span></div><div class="line">    <span class="comment">// 如果path为：/blog-post, route为：/blog</span></div><div class="line">    <span class="comment">// 这种情况不满足包含关系，那么也跳过这个中间件的执行</span></div><div class="line"></div><div class="line">    <span class="comment">// 如果path为：/blog.或者/blog/, route为：/blog</span></div><div class="line">    <span class="comment">// 这种情况也视为满足包含关系，也就是说会执行对应的中间件</span></div><div class="line">    <span class="keyword">var</span> c = path.length &gt; route.length &amp;&amp; path[route.length]</div><div class="line">    <span class="keyword">if</span> (c &amp;&amp; c !== <span class="string">'/'</span> &amp;&amp; c !== <span class="string">'.'</span>) &#123;</div><div class="line">      <span class="keyword">return</span> next(err)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// trim off the part of the url that matches the route</span></div><div class="line">    <span class="keyword">if</span> (route.length !== <span class="number">0</span> &amp;&amp; route !== <span class="string">'/'</span>) &#123;</div><div class="line">      <span class="comment">// 如果route为：/blog，path为：/blog/post</span></div><div class="line">      <span class="comment">// 那么该url会被处理成 protohost + '/post'</span></div><div class="line"></div><div class="line">      <span class="comment">// route这段会被移除</span></div><div class="line">      removed = route</div><div class="line">      <span class="comment">// ①</span></div><div class="line">      req.url = protohost + req.url.substr(protohost.length + removed.length)</div><div class="line"></div><div class="line">      <span class="comment">// ensure leading slash</span></div><div class="line">      <span class="comment">// getProtohost函数可以知道，可能没有得到协议加主机部分</span></div><div class="line">      <span class="comment">// 并且有可能你请求的path为'/'，</span></div><div class="line">      <span class="comment">// 那么上面①处得到url就为空('')</span></div><div class="line">      <span class="comment">// 所以此处的操作确在这种情况下,url前面有个`/`</span></div><div class="line">      <span class="keyword">if</span> (!protohost &amp;&amp; req.url[<span class="number">0</span>] !== <span class="string">'/'</span>) &#123;</div><div class="line">        req.url = <span class="string">'/'</span> + req.url</div><div class="line">        <span class="comment">// 表明已经添加过'/'</span></div><div class="line">        slashAdded = <span class="literal">true</span></div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// call the layer handle</span></div><div class="line">    <span class="comment">// 开始调用中间件</span></div><div class="line">    call(layer.handle, route, err, req, res, next)</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  next()</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>通过<code>getProtohost</code>函数得到一个 url 的<em>协议+主机</em>：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">getProtohost</span>(<span class="params">url</span>) </span>&#123;</div><div class="line">  <span class="comment">// 如果url为一个空字符串</span></div><div class="line">  <span class="comment">// 或者是以`/`开头，那么表明不带有协议部分</span></div><div class="line">  <span class="comment">// 那么直接返回undefined</span></div><div class="line">  <span class="keyword">if</span> (url.length === <span class="number">0</span> || url[<span class="number">0</span>] === <span class="string">'/'</span>) &#123;</div><div class="line">    <span class="keyword">return</span> <span class="literal">undefined</span></div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">// 找到search出现的位置</span></div><div class="line">  <span class="keyword">var</span> searchIndex = url.indexOf(<span class="string">'?'</span>)</div><div class="line">  <span class="keyword">var</span> pathLength = searchIndex !== <span class="number">-1</span> ? searchIndex : url.length</div><div class="line">  <span class="comment">// 从url中找到`://`出现的位置</span></div><div class="line">  <span class="keyword">var</span> fqdnIndex = url.substr(<span class="number">0</span>, pathLength).indexOf(<span class="string">'://'</span>)</div><div class="line"></div><div class="line">  <span class="comment">// 如果url中含有`://`，那么表示这是一个带有协议的url</span></div><div class="line">  <span class="keyword">return</span> fqdnIndex !== <span class="number">-1</span></div><div class="line">    ? <span class="comment">// 得到path中第一次出现`/`前面的部分，也就是协议+主机</span></div><div class="line">      url.substr(<span class="number">0</span>, url.indexOf(<span class="string">'/'</span>, <span class="number">3</span> + fqdnIndex))</div><div class="line">    : <span class="literal">undefined</span></div><div class="line">&#125;</div></pre></td></tr></table></figure><blockquote><p>关于一个 url 中的各个部分的名称，可以看下图：</p></blockquote><img src="/2018/11/27/connect/url-segments.png" alt="url片段术语" title="url片段术语"><p>上面的介绍的<code>next</code>方法用来控制是否继续执行下一个中间件，此处的<code>call</code>方法就是用来执行某一个中间件。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// handle，就是每一个中间件</span></div><div class="line"><span class="comment">// route，就是调用app.use(route,fn)中的route，在该函数中没有什么特别的用处，主要用来显示日志</span></div><div class="line"><span class="comment">// err，调用错误中间件中的err</span></div><div class="line"><span class="comment">// req，http.IncommingMessage</span></div><div class="line"><span class="comment">// res，http.ServerResponse</span></div><div class="line"><span class="comment">// next，上面介绍的next</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">call</span>(<span class="params">handle, route, err, req, res, next</span>) </span>&#123;</div><div class="line">  <span class="comment">// 函数的形参个数</span></div><div class="line">  <span class="keyword">var</span> arity = handle.length</div><div class="line">  <span class="keyword">var</span> error = err</div><div class="line">  <span class="keyword">var</span> hasError = <span class="built_in">Boolean</span>(err)</div><div class="line"></div><div class="line">  debug(<span class="string">'%s %s : %s'</span>, handle.name || <span class="string">'&lt;anonymous&gt;'</span>, route, req.originalUrl)</div><div class="line"></div><div class="line">  <span class="keyword">try</span> &#123;</div><div class="line">    <span class="comment">// 经过此处的条件语句，我们可以知道</span></div><div class="line">    <span class="comment">// 在你调用使用错误中间件的时候，形参一定要是4个参数</span></div><div class="line">    <span class="comment">// 多余4个或者少于4个都不会执行</span></div><div class="line">    <span class="keyword">if</span> (hasError &amp;&amp; arity === <span class="number">4</span>) &#123;</div><div class="line">      <span class="comment">// error-handling middleware</span></div><div class="line">      handle(err, req, res, next)</div><div class="line">      <span class="keyword">return</span></div><div class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!hasError &amp;&amp; arity &lt; <span class="number">4</span>) &#123;</div><div class="line">      <span class="comment">// 不是错误中间件，那么形参一定要小于4个</span></div><div class="line">      <span class="comment">// request-handling middleware</span></div><div class="line">      handle(req, res, next)</div><div class="line">      <span class="keyword">return</span></div><div class="line">    &#125;</div><div class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</div><div class="line">    <span class="comment">// replace the error</span></div><div class="line">    error = e</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">// continue</span></div><div class="line">  <span class="comment">// 当前中间件执行完毕后，调用next来启动下一个中间件的执行</span></div><div class="line">  <span class="comment">// 并且将error对象一直传递下去</span></div><div class="line">  next(error)</div><div class="line">&#125;</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;connect-简介&quot;&gt;&lt;a href=&quot;#connect-简介&quot; class=&quot;headerlink&quot; title=&quot;connect 简介&quot;&gt;&lt;/a&gt;connect 简介&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;connect 是一款极简的 web 框架，串联各
      
    
    </summary>
    
      <category term="nodejs" scheme="https://xxxxxmiss.github.io/categories/nodejs/"/>
    
    
      <category term="nodejs" scheme="https://xxxxxmiss.github.io/tags/nodejs/"/>
    
      <category term="http" scheme="https://xxxxxmiss.github.io/tags/http/"/>
    
      <category term="connect" scheme="https://xxxxxmiss.github.io/tags/connect/"/>
    
  </entry>
  
  <entry>
    <title>ee-first源码解读</title>
    <link href="https://xxxxxmiss.github.io/2018/11/26/ee-first/"/>
    <id>https://xxxxxmiss.github.io/2018/11/26/ee-first/</id>
    <published>2018-11-26T13:51:16.000Z</published>
    <updated>2018-11-27T13:36:29.965Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ee-first"><a href="#ee-first" class="headerlink" title="ee-first"></a>ee-first</h2><blockquote><p>从一个事件列表中触发一个事件，一旦触发了该事件之后，就会移除该事件及其他所有的事件。</p></blockquote><h2 id="API"><a href="#API" class="headerlink" title="API"></a>API</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> first = <span class="built_in">require</span>(<span class="string">'ee-first'</span>)</div></pre></td></tr></table></figure><h3 id="first-arr-listener"><a href="#first-arr-listener" class="headerlink" title="first(arr, listener)"></a>first(arr, listener)</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> ee1 = <span class="keyword">new</span> EventEmitter()</div><div class="line"><span class="keyword">const</span> ee2 = <span class="keyword">new</span> EventEmitter()</div><div class="line">first(</div><div class="line">  [[ee1, <span class="string">'end'</span>, <span class="string">'finish'</span>], [ee1, <span class="string">'error'</span>, <span class="string">'end'</span>]],</div><div class="line">  (error, ee, event, args) =&gt; &#123;</div><div class="line">    <span class="comment">// listener invoked</span></div><div class="line">  &#125;</div><div class="line">)</div></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 核心代码</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">first</span>(<span class="params">stuff, done</span>) </span>&#123;</div><div class="line">  <span class="comment">// stuff类型校验，略去</span></div><div class="line">  <span class="keyword">var</span> cleanups = []</div><div class="line"></div><div class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; stuff.length; i++) &#123;</div><div class="line">    <span class="keyword">var</span> arr = stuff[i]</div><div class="line"></div><div class="line">    <span class="comment">// arr类型校验，略去</span></div><div class="line">    <span class="keyword">var</span> ee = arr[<span class="number">0</span>] <span class="comment">// EventEmitter实例</span></div><div class="line"></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">1</span>; j &lt; arr.length; j++) &#123;</div><div class="line">      <span class="keyword">var</span> event = arr[j] <span class="comment">// 事件名</span></div><div class="line">      <span class="keyword">var</span> fn = listener(event, callback)</div><div class="line"></div><div class="line">      <span class="comment">// listen to the event</span></div><div class="line">      <span class="comment">// 此处只要触发了一个事件，结合下面`listener`的分析得知，</span></div><div class="line">      <span class="comment">// 那么最终会执行callback，而该callback就是清除所有的EventEmitter实例上的所有事件</span></div><div class="line">      ee.on(event, fn)</div><div class="line">      <span class="comment">// push this listener to the list of cleanups</span></div><div class="line">      cleanups.push(&#123;</div><div class="line">        <span class="attr">ee</span>: ee,</div><div class="line">        <span class="attr">event</span>: event,</div><div class="line">        <span class="attr">fn</span>: fn</div><div class="line">      &#125;)</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">// 这个callback就是`listener`函数中的done</span></div><div class="line">  <span class="comment">// 执行该函数会传递进来`err`, `ee`, `event`, `args`</span></div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">callback</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    cleanup()</div><div class="line"></div><div class="line">    <span class="comment">// 所有此处执行入口函数中的done, 并传入上面的4个参数</span></div><div class="line">    done.apply(<span class="literal">null</span>, <span class="built_in">arguments</span>)</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">cleanup</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> x</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; cleanups.length; i++) &#123;</div><div class="line">      x = cleanups[i]</div><div class="line">      x.ee.removeListener(x.event, x.fn)</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">thunk</span>(<span class="params">fn</span>) </span>&#123;</div><div class="line">    done = fn</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  thunk.cancel = cleanup</div><div class="line"></div><div class="line">  <span class="comment">// 此处返回一个thunk函数，通过该函数上的cancel方法，</span></div><div class="line">  <span class="comment">// 可以直接清除所有EventEmitter实例上的所有事件</span></div><div class="line">  <span class="keyword">return</span> thunk</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">listener</span>(<span class="params">event, done</span>) </span>&#123;</div><div class="line">  <span class="comment">// 因为返回的onevent会作为指定事件的监听器</span></div><div class="line">  <span class="comment">// 当执行该事件监听器是，`this`指向该EventEmitter实例</span></div><div class="line">  <span class="comment">// 如果使用箭头函数，那么`this`就不指向EventEmitter实例了</span></div><div class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">onevent</span>(<span class="params">arg1</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> args = <span class="keyword">new</span> <span class="built_in">Array</span>(<span class="built_in">arguments</span>.length)</div><div class="line">    <span class="keyword">var</span> ee = <span class="keyword">this</span></div><div class="line">    <span class="comment">// 如果监听的是一个error事件，那么第一个参数就是执行该监听器传递进来的参数（一个错误对象）</span></div><div class="line">    <span class="comment">// 监听的其他事件，那么该参数设置为null</span></div><div class="line">    <span class="keyword">var</span> err = event === <span class="string">'error'</span> ? arg1 : <span class="literal">null</span></div><div class="line"></div><div class="line">    <span class="comment">// copy args to prevent arguments escaping scope</span></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; args.length; i++) &#123;</div><div class="line">      args[i] = <span class="built_in">arguments</span>[i]</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// 最终会执行传递进来的done</span></div><div class="line">    done(err, ee, event, args)</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><h3 id="cancel"><a href="#cancel" class="headerlink" title=".cancel()"></a>.cancel()</h3><blockquote><p>直接移除所有<code>EventEmitter</code>实例上的所有监听器</p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;ee-first&quot;&gt;&lt;a href=&quot;#ee-first&quot; class=&quot;headerlink&quot; title=&quot;ee-first&quot;&gt;&lt;/a&gt;ee-first&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;从一个事件列表中触发一个事件，一旦触发了该事件之后，就会移除该事件
      
    
    </summary>
    
      <category term="nodejs" scheme="https://xxxxxmiss.github.io/categories/nodejs/"/>
    
    
      <category term="nodejs" scheme="https://xxxxxmiss.github.io/tags/nodejs/"/>
    
      <category term="events" scheme="https://xxxxxmiss.github.io/tags/events/"/>
    
      <category term="ee-first" scheme="https://xxxxxmiss.github.io/tags/ee-first/"/>
    
  </entry>
  
  <entry>
    <title>source-connect</title>
    <link href="https://xxxxxmiss.github.io/2018/11/23/source-connect/"/>
    <id>https://xxxxxmiss.github.io/2018/11/23/source-connect/</id>
    <published>2018-11-23T09:26:55.000Z</published>
    <updated>2018-11-23T09:27:43.695Z</updated>
    
    <summary type="html">
    
    </summary>
    
      <category term="nodejs" scheme="https://xxxxxmiss.github.io/categories/nodejs/"/>
    
    
      <category term="nodejs" scheme="https://xxxxxmiss.github.io/tags/nodejs/"/>
    
      <category term="http" scheme="https://xxxxxmiss.github.io/tags/http/"/>
    
      <category term="connect" scheme="https://xxxxxmiss.github.io/tags/connect/"/>
    
  </entry>
  
  <entry>
    <title>http-range</title>
    <link href="https://xxxxxmiss.github.io/2018/11/21/http-range/"/>
    <id>https://xxxxxmiss.github.io/2018/11/21/http-range/</id>
    <published>2018-11-21T13:46:00.000Z</published>
    <updated>2018-11-21T17:04:21.665Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Range-简介"><a href="#Range-简介" class="headerlink" title="Range 简介"></a>Range 简介</h2><blockquote><p><em>Range</em>是一个请求首部，告知服务器返回文件的哪一部分。在一个<em>Range</em>首部中，可以一次性请求多个部分，服务器会以<em>multipart</em>文件的形式将其返回。</p></blockquote><ul><li>如果服务器返回的是范围响应，需要使用<code>206 Partial Content</code>状态码。</li><li>假如所请求的范围不合法，那么服务器会返回<code>416 Range Not Satisfiable</code>状态码，表示客户端错误。</li><li>服务器允许忽略 Range 首部，从而返回整个文件，状态码用<code>200</code> 。</li></ul><h2 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h2><blockquote><p>Range: <unit>=<range-start>-<br>Range: <unit>=<range-start>-<range-end><br>Range: <unit>=<range-start>-<range-end>, <range-start>-<range-end><br>Range: <unit>=<range-start>-<range-end>, <range-start>-<range-end>, <range-start>-<range-end></range-end></range-start></range-end></range-start></range-end></range-start></unit></range-end></range-start></range-end></range-start></unit></range-end></range-start></unit></range-start></unit></p></blockquote><h2 id="range-parser源码解读"><a href="#range-parser源码解读" class="headerlink" title="range-parser源码解读"></a><a href="https://github.com/jshttp/range-parser" target="_blank" rel="external">range-parser</a>源码解读</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">rangeParser</span>(<span class="params">size, str, options</span>) </span>&#123;</div><div class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> str !== <span class="string">'string'</span>) &#123;</div><div class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">'argument str must be a string'</span>)</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">var</span> index = str.indexOf(<span class="string">'='</span>)</div><div class="line"></div><div class="line">  <span class="keyword">if</span> (index === <span class="number">-1</span>) &#123;</div><div class="line">    <span class="comment">// -2： 表示str是一个不符合range语法的字符串</span></div><div class="line">    <span class="keyword">return</span> <span class="number">-2</span></div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">// split the range string</span></div><div class="line">  <span class="comment">// 将多个range以逗号分割</span></div><div class="line">  <span class="keyword">var</span> arr = str.slice(index + <span class="number">1</span>).split(<span class="string">','</span>)</div><div class="line">  <span class="keyword">var</span> ranges = []</div><div class="line"></div><div class="line">  <span class="comment">// add ranges type</span></div><div class="line">  <span class="comment">// 获取单位&lt;unit&gt;，这个单位一般为bytes</span></div><div class="line">  ranges.type = str.slice(<span class="number">0</span>, index)</div><div class="line"></div><div class="line">  <span class="comment">// parse all ranges</span></div><div class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; arr.length; i++) &#123;</div><div class="line">    <span class="keyword">var</span> range = arr[i].split(<span class="string">'-'</span>)</div><div class="line">    <span class="keyword">var</span> start = <span class="built_in">parseInt</span>(range[<span class="number">0</span>], <span class="number">10</span>)</div><div class="line">    <span class="keyword">var</span> end = <span class="built_in">parseInt</span>(range[<span class="number">1</span>], <span class="number">10</span>)</div><div class="line"></div><div class="line">    <span class="comment">// -nnn</span></div><div class="line">    <span class="comment">// 如果没有起始范围（索引），如：bytes=-10</span></div><div class="line">    <span class="keyword">if</span> (<span class="built_in">isNaN</span>(start)) &#123;</div><div class="line">      start = size - end</div><div class="line">      end = size - <span class="number">1</span></div><div class="line">      <span class="comment">// nnn-</span></div><div class="line">      <span class="comment">// 如果没有结束范围（索引），如：bytes=10-</span></div><div class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">isNaN</span>(end)) &#123;</div><div class="line">      end = size - <span class="number">1</span></div><div class="line">    &#125;</div><div class="line">    <span class="comment">// limit last-byte-pos to current length</span></div><div class="line">    <span class="comment">// 如果结束索引超出了最大索引，那么设置结束索引为最大索引</span></div><div class="line">    <span class="keyword">if</span> (end &gt; size - <span class="number">1</span>) &#123;</div><div class="line">      end = size - <span class="number">1</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// invalid or unsatisifiable</span></div><div class="line">    <span class="comment">// 如果经过上面处理之后，还有一些无效的情况</span></div><div class="line">    <span class="comment">// 如：起始索引大于结束索引，或者开始索引是负数等</span></div><div class="line">    <span class="comment">// 那么跳过这些情况</span></div><div class="line">    <span class="keyword">if</span> (<span class="built_in">isNaN</span>(start) || <span class="built_in">isNaN</span>(end) || start &gt; end || start &lt; <span class="number">0</span>) &#123;</div><div class="line">      <span class="keyword">continue</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// add range</span></div><div class="line">    ranges.push(&#123;</div><div class="line">      <span class="attr">start</span>: start,</div><div class="line">      <span class="attr">end</span>: end</div><div class="line">    &#125;)</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">// 如果最终都没有解析到有效的，那么返回-1</span></div><div class="line">  <span class="keyword">if</span> (ranges.length &lt; <span class="number">1</span>) &#123;</div><div class="line">    <span class="comment">// unsatisifiable</span></div><div class="line">    <span class="keyword">return</span> <span class="number">-1</span></div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">// 如果传入options.combine，那么先处理索引重叠的情况</span></div><div class="line">  <span class="comment">// 否则直接返回</span></div><div class="line">  <span class="keyword">return</span> options &amp;&amp; options.combine ? combineRanges(ranges) : ranges</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>处理索引有重叠，合并小的连续的范围：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// var range = parse(150, 'bytes=0-4,90-99,5-75,100-199,101-102', &#123; combine: true &#125;)</span></div><div class="line"><span class="comment">// assert.strictEqual(range.type, 'bytes')</span></div><div class="line"><span class="comment">// assert.strictEqual(range.length, 2)</span></div><div class="line"><span class="comment">// assert.deepEqual(range[0], &#123; start: 0, end: 75 &#125;)</span></div><div class="line"><span class="comment">// assert.deepEqual(range[1], &#123; start: 90, end: 149 &#125;)</span></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Combine overlapping &amp; adjacent ranges.</div><div class="line"> * @private</div><div class="line"> */</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">combineRanges</span>(<span class="params">ranges</span>) </span>&#123;</div><div class="line">  <span class="comment">// [</span></div><div class="line">  <span class="comment">//   &#123; start: 0, end: 4, index: 0 &#125;,</span></div><div class="line">  <span class="comment">//   &#123; start: 5, end: 75, index: 2 &#125;,</span></div><div class="line">  <span class="comment">//   &#123; start: 90, end: 99, index: 1 &#125;,</span></div><div class="line">  <span class="comment">//   &#123; start: 101, end: 102, index: 4 &#125;,</span></div><div class="line">  <span class="comment">//   &#123; start: 100, end: 199, index: 3 &#125;,</span></div><div class="line">  <span class="comment">// ]</span></div><div class="line">  <span class="keyword">var</span> ordered = ranges.map(mapWithIndex).sort(sortByRangeStart)</div><div class="line"></div><div class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>, i = <span class="number">1</span>; i &lt; ordered.length; i++) &#123;</div><div class="line">    <span class="keyword">var</span> range = ordered[i]</div><div class="line">    <span class="keyword">var</span> current = ordered[j]</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (range.start &gt; current.end + <span class="number">1</span>) &#123;</div><div class="line">      <span class="comment">// next range</span></div><div class="line">      ordered[++j] = range</div><div class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (range.end &gt; current.end) &#123;</div><div class="line">      <span class="comment">// extend range</span></div><div class="line">      current.end = range.end</div><div class="line">      current.index = <span class="built_in">Math</span>.min(current.index, range.index)</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">// trim ordered array</span></div><div class="line">  ordered.length = j + <span class="number">1</span></div><div class="line"></div><div class="line">  <span class="comment">// generate combined range</span></div><div class="line">  <span class="keyword">var</span> combined = ordered.sort(sortByRangeIndex).map(mapWithoutIndex)</div><div class="line"></div><div class="line">  <span class="comment">// copy ranges type</span></div><div class="line">  combined.type = ranges.type</div><div class="line"></div><div class="line">  <span class="keyword">return</span> combined</div><div class="line">&#125;</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;Range-简介&quot;&gt;&lt;a href=&quot;#Range-简介&quot; class=&quot;headerlink&quot; title=&quot;Range 简介&quot;&gt;&lt;/a&gt;Range 简介&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;&lt;em&gt;Range&lt;/em&gt;是一个请求首部，告知服务器返回文件的哪
      
    
    </summary>
    
      <category term="http" scheme="https://xxxxxmiss.github.io/categories/http/"/>
    
    
      <category term="http" scheme="https://xxxxxmiss.github.io/tags/http/"/>
    
      <category term="range" scheme="https://xxxxxmiss.github.io/tags/range/"/>
    
  </entry>
  
  <entry>
    <title>http-etag-if-none-match</title>
    <link href="https://xxxxxmiss.github.io/2018/11/19/http-etag-if-none-match/"/>
    <id>https://xxxxxmiss.github.io/2018/11/19/http-etag-if-none-match/</id>
    <published>2018-11-19T12:57:22.000Z</published>
    <updated>2018-11-23T09:21:50.286Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ETag简介"><a href="#ETag简介" class="headerlink" title="ETag简介"></a>ETag简介</h2><blockquote><p>是资源的特定版本的标识符，这可以让缓存更高效，并节省带宽，因为如果内容没有改变，Web服务器不需要发送完整的响应。ETag有强弱之分：</p></blockquote><ul><li><p><code>W/&quot;&lt;etag_value&gt;&quot;</code>: 弱验证器很容易生成，但不利于比较。 强验证器是比较的理想选择，但很难有效地生成。 相同资源的两个弱Etag值可能语义等同，但不是每个字节都相同。</p></li><li><p><code>&quot;&lt;etag_value&gt;&quot;</code>: 没有明确指定生成ETag值的方法。 通常，使用内容的散列。</p></li></ul><h2 id="nodjs-etag模块"><a href="#nodjs-etag模块" class="headerlink" title="nodjs etag模块"></a><a href="https://github.com/jshttp/etag" target="_blank" rel="external">nodjs etag模块</a></h2><p>etag(entity, options)</p><blockquote><p>entity: 可以是<code>String</code>, <code>Buffer</code>, <code>fs.Stats</code><br>options.weak: 是否生成弱的etag, 默认为false（即默认生成强的etag），但是如果<code>entity</code>为<code>fs.Stats</code>，那么生成弱的etag。</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 只列出核心代码，一些对参数的校验啥的已略过</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">etag</span> (<span class="params">entity, options</span>) </span>&#123;</div><div class="line">  <span class="comment">// 判断entity是否为fs.Stats类型</span></div><div class="line">  <span class="keyword">var</span> isStats = isstats(entity)</div><div class="line">  <span class="keyword">var</span> weak = options &amp;&amp; <span class="keyword">typeof</span> options.weak === <span class="string">'boolean'</span></div><div class="line">    ? options.weak</div><div class="line">    : isStats</div><div class="line"></div><div class="line">  <span class="comment">// generate entity tag</span></div><div class="line">  <span class="keyword">var</span> tag = isStats</div><div class="line">    ? stattag(entity)</div><div class="line">    : entitytag(entity)</div><div class="line"></div><div class="line">  <span class="keyword">return</span> weak</div><div class="line">    ? <span class="string">'W/'</span> + tag <span class="comment">// 弱etag</span></div><div class="line">    : tag</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 弱的etag是根据fs.Stats生成</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">stattag</span> (<span class="params">stat</span>) </span>&#123;</div><div class="line">  <span class="comment">// 得到mtime时间戳的16进制</span></div><div class="line">  <span class="keyword">var</span> mtime = stat.mtime.getTime().toString(<span class="number">16</span>)</div><div class="line">  <span class="comment">// 得到size的16进制</span></div><div class="line">  <span class="keyword">var</span> size = stat.size.toString(<span class="number">16</span>)</div><div class="line">  <span class="comment">// 按照规范etag，应该用双引号包裹生成的字符串。</span></div><div class="line">  <span class="keyword">return</span> <span class="string">'"'</span> + size + <span class="string">'-'</span> + mtime + <span class="string">'"'</span></div><div class="line">&#125;</div><div class="line"><span class="comment">// 强tag，是将buffer或者字符串进行sha1，</span></div><div class="line"><span class="comment">// 在进行base64编码，在截取前27位</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">entitytag</span> (<span class="params">entity</span>) </span>&#123;</div><div class="line">  <span class="keyword">if</span> (entity.length === <span class="number">0</span>) &#123;</div><div class="line">    <span class="comment">// fast-path empty</span></div><div class="line">    <span class="keyword">return</span> <span class="string">'"0-2jmj7l5rSw0yVb/vlWAYkK/YBwk"'</span></div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">// compute hash of entity</span></div><div class="line">  <span class="keyword">var</span> hash = crypto</div><div class="line">    .createHash(<span class="string">'sha1'</span>)</div><div class="line">    .update(entity, <span class="string">'utf8'</span>)</div><div class="line">    .digest(<span class="string">'base64'</span>)</div><div class="line">    .substring(<span class="number">0</span>, <span class="number">27</span>)</div><div class="line"></div><div class="line">  <span class="comment">// 获取字符串或者buffer的字节数</span></div><div class="line">  <span class="keyword">var</span> len = <span class="keyword">typeof</span> entity === <span class="string">'string'</span></div><div class="line">    ? Buffer.byteLength(entity, <span class="string">'utf8'</span>)</div><div class="line">    : entity.length</div><div class="line"></div><div class="line">  <span class="comment">// " + 字节数的16进制 + 连接符 + hash + " =&gt; 强etag</span></div><div class="line">  <span class="keyword">return</span> <span class="string">'"'</span> + len.toString(<span class="number">16</span>) + <span class="string">'-'</span> + hash + <span class="string">'"'</span></div><div class="line">&#125;</div></pre></td></tr></table></figure><h2 id="http缓存机制"><a href="#http缓存机制" class="headerlink" title="http缓存机制"></a>http缓存机制</h2><blockquote><p>主要由以下请求头和响应头控制：</p></blockquote><ul><li>Expires</li><li>Cache-Control</li><li>Last-Modified</li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/If-Match" target="_blank" rel="external">If-Match</a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/If-None-Match" target="_blank" rel="external">If-None-Match</a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/If-Modified-Since" target="_blank" rel="external">If-Modified-Since</a></li><li><a href="(https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/If-Unmodified-Since">If-Unmodified-Since</a></li><li>Etag</li></ul><h3 id="Cache-Control易混淆点解释"><a href="#Cache-Control易混淆点解释" class="headerlink" title="Cache-Control易混淆点解释"></a>Cache-Control易混淆点解释</h3><blockquote><p>单个的，常用的属性解释：</p></blockquote><ul><li><p>max-age：用来设置资源可以被缓存多长时间，单位为秒；</p></li><li><p>s-maxage：和max-age是一样的，不过它只针对代理服务器缓存而言；</p></li><li><p>public：指示响应可被任何缓存区缓存（服务器，代理，客户端）；</p></li><li><p>private：只能针对个人用户，而不能被代理服务器缓存；</p></li><li><p>no-cache：强制客户端直接向服务器发送请求,也就是说每次请求都必须向服务器发送。服务器接收到请求，然后判断资源是否变更，是则返回新内容，否则返回304，未变更。这个很容易让人产生误解，使人误以为是响应不被缓存。实际上Cache-Control: no-cache是会被缓存的，只不过每次在向客户端（浏览器）提供响应数据时，缓存都要向服务器评估缓存响应的有效性。</p></li><li><p>no-store：禁止一切缓存（这个才是响应不被缓存的意思）。</p></li></ul><blockquote><p>组合属性解释：</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">cache</span>-control:<span class="keyword">private</span>, <span class="keyword">no</span>-<span class="keyword">cache</span>, <span class="keyword">no</span>-<span class="keyword">store</span>, must-revalidate</div></pre></td></tr></table></figure><p>很多情况下，你会看到如上的组合。其实上面的组合是冗余的，但是它可能并不是原始服务器设置的，而是经过多个设备，最终组合成上面的形式。<br>我们可以根据上面<a href="#Cache-Control易混淆点解释">单个属性</a>的解释，可以得出上面的组合其实等同于如下：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">cache</span>-control:<span class="keyword">no</span>-<span class="keyword">store</span></div></pre></td></tr></table></figure><p>也就是当出现多个属性组合时，要根据单个属性的定义得出最终的值，并不是所有的值都生效。</p><p><a href="https://tools.ietf.org/html/rfc7234#section-4.2.1" target="_blank" rel="external">More</a></p><h2 id="常用条件请求的搭配之一"><a href="#常用条件请求的搭配之一" class="headerlink" title="常用条件请求的搭配之一"></a>常用条件请求的搭配之一</h2><blockquote><p><code>ETag</code>和<code>If-None-Math</code>，原理解释如下：</p></blockquote><ol><li>第一次请求由服务端生成etag，并随响应头一起返回给客户端</li><li>当你第二次发起<em>同一个请求</em>时，客户端会发送一个<code>If-None-Match</code>的请求头，该请求头的值就是etag的值。然后服务器会将客户端发送过来的etag与自己保存的etag做比较。如果是一样的，那么就返回<code>304</code>，表明客户端可以继续使用本地缓存。否则就返回<code>200</code>，客户端重新解析服务器返回的数据。</li></ol><h3 id="演示demo"><a href="#演示demo" class="headerlink" title="演示demo"></a>演示demo</h3><h2 id="文件结构："><a href="#文件结构：" class="headerlink" title="文件结构："></a>文件结构：</h2><p>|-rxjs<br>|——index.html<br>|-server.js<br>|-client.html</p><p>客户端：<br>client.html<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://127.0.0.1:3000"</span>&gt;</span>测试链接<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure></p><p>服务端<br>server.js<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>)</div><div class="line"><span class="keyword">const</span> serveStatic = <span class="built_in">require</span>(<span class="string">'serve-static'</span>)</div><div class="line"><span class="keyword">const</span> finalhandler = <span class="built_in">require</span>(<span class="string">'finalhandler'</span>)</div><div class="line"></div><div class="line"><span class="comment">// rxjs是和该脚本放在同一个目录下的一个文件夹</span></div><div class="line"><span class="comment">// 可以在rxjs文件夹下放置一个index.html</span></div><div class="line"><span class="comment">// 修改rxjs/index.html中的内容，然后观察network中etag和if-none-match的变化以及stausCode的变化</span></div><div class="line"><span class="keyword">const</span> serve = serveStatic(<span class="string">'rxjs'</span>)</div><div class="line"><span class="keyword">const</span> server = http.createServer(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</div><div class="line">  serve(req, res, finalhandler(req, res))</div><div class="line">&#125;)</div><div class="line"></div><div class="line">server.listen(<span class="number">3000</span>, () =&gt; &#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'Server is listening port: 3000'</span>)</div><div class="line">&#125;)</div></pre></td></tr></table></figure></p><h2 id="Last-Modified-amp-If-Modified-Since"><a href="#Last-Modified-amp-If-Modified-Since" class="headerlink" title="Last-Modified &amp; If-Modified-Since"></a>Last-Modified &amp; If-Modified-Since</h2><p>Last-Modified与Etag类似。不过Last-Modified表示响应资源在服务器最后修改时间而已。与Etag相比，不足为：</p><ul><li><p>Last-Modified标注的最后修改只能精确到秒级，如果某些文件在1秒钟以内，被修改多次的话，它将不能准确标注文件的修改时间；</p></li><li><p>如果某些文件会被定期生成，当有时内容并没有任何变化，但Last-Modified却改变了，导致文件没法使用缓存；</p></li><li><p>有可能存在服务器没有准确获取文件修改时间，或者与代理服务器时间不一致等情形。</p></li></ul><p>然而，Etag是服务器自动生成或者由开发者生成的对应资源在服务器端的唯一标识符，能够更加准确的控制缓存。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;ETag简介&quot;&gt;&lt;a href=&quot;#ETag简介&quot; class=&quot;headerlink&quot; title=&quot;ETag简介&quot;&gt;&lt;/a&gt;ETag简介&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;是资源的特定版本的标识符，这可以让缓存更高效，并节省带宽，因为如果内容没有改变，W
      
    
    </summary>
    
      <category term="http" scheme="https://xxxxxmiss.github.io/categories/http/"/>
    
    
      <category term="http" scheme="https://xxxxxmiss.github.io/tags/http/"/>
    
      <category term="etag" scheme="https://xxxxxmiss.github.io/tags/etag/"/>
    
      <category term="if-none-match" scheme="https://xxxxxmiss.github.io/tags/if-none-match/"/>
    
  </entry>
  
  <entry>
    <title>http-redirection</title>
    <link href="https://xxxxxmiss.github.io/2018/11/18/http-redirection/"/>
    <id>https://xxxxxmiss.github.io/2018/11/18/http-redirection/</id>
    <published>2018-11-18T06:51:13.000Z</published>
    <updated>2018-11-18T08:33:56.933Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Permanent-Redirection-永久重定向"><a href="#Permanent-Redirection-永久重定向" class="headerlink" title="Permanent Redirection(永久重定向)"></a>Permanent Redirection(永久重定向)</h2><table><thead><tr><th>statusCode</th><th>含义</th><th>处理方法</th><th>场景</th></tr></thead><tbody><tr><td>301</td><td>Moved Permanently</td><td>GET 方法不会发生变更，其他方法有可能会变更为 GET 方法</td><td>-</td></tr><tr><td>308</td><td>Permanent Redirect</td><td>方法和消息主体都不发生变化</td><td>-</td></tr></tbody></table><h2 id="Temporary-Redirection-临时重定向"><a href="#Temporary-Redirection-临时重定向" class="headerlink" title="Temporary Redirection(临时重定向)"></a>Temporary Redirection(临时重定向)</h2><table><thead><tr><th>statusCode</th><th>含义</th><th>处理方法</th><th>场景</th></tr></thead><tbody><tr><td>302</td><td>Found</td><td>GET 方法不会发生变更，其他方法有可能会变更为 GET 方法</td><td>-</td></tr><tr><td>303</td><td>See Other</td><td>GET 方法不会发生变更，其他方法会变更为 GET 方法（消息主体会丢失)</td><td>-</td></tr><tr><td>307</td><td>Temporary Redirect</td><td>方法和消息主体都不发生变化</td><td>-</td></tr></tbody></table><h2 id="Special-Redirection-特殊重定向"><a href="#Special-Redirection-特殊重定向" class="headerlink" title="Special Redirection(特殊重定向)"></a>Special Redirection(特殊重定向)</h2><table><thead><tr><th>statusCode</th><th>含义</th><th>场景</th></tr></thead><tbody><tr><td>300</td><td>Multiple Choice</td><td>不会太多：所有的选项在消息主体的 HTML 页面中列出。也可以返回 200 OK 状态码。</td></tr><tr><td>304</td><td>Not Modified</td><td>缓存刷新：该状态码表示缓存值依然有效，可以使用。</td></tr></tbody></table><h2 id="重定向的3种方法"><a href="#重定向的3种方法" class="headerlink" title="重定向的3种方法"></a>重定向的3种方法</h2><blockquote><p>当这3种方式同时存在时，优先级由高到低：http &gt; html meta &gt; js。</p></blockquote><ul><li>使用http协议重定向（上面介绍的3种重定向）</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">res.statusCode = <span class="number">307</span></div><div class="line">res.setHeader(<span class="string">'Location'</span>, <span class="string">'/doc-new'</span>)</div></pre></td></tr></table></figure><ul><li>使用html<code>meta</code>标签</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span> </div><div class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"refresh"</span> <span class="attr">content</span>=<span class="string">"0;URL=http://www.example.com/"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div></pre></td></tr></table></figure><blockquote><p><code>content</code> 属性的值开头是一个数字，指示浏览器在等待该数字表示的秒数之后再进行跳转。建议始终将其设置为 0 来获取更好的可访问性。</p></blockquote><ul><li>使用js</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">window</span>.location.href = <span class="string">'http://www.example.com/'</span></div></pre></td></tr></table></figure><h2 id="对于不安全请求的临时响应节"><a href="#对于不安全请求的临时响应节" class="headerlink" title="对于不安全请求的临时响应节"></a>对于不安全请求的临时响应节</h2><p>不安全请求会修改服务器端的状态，应该避免用户无意的重复操作。一般地，你并不想要你的用户重复发送 <code>PUT</code>、<code>POST</code> 或 <code>DELETE</code> 请求。假如你仅仅为该类请求返回响应的话，简单地点击刷新按钮就会（可能会有一个确认信息）导致请求的重复发送。</p><p>在这种情况下，服务器可以返回一个 303 (See Other) 响应，其中含有合适的响应信息。如果刷新按钮被点击的话，只会导致该页面被刷新，而不会重复提交不安全的请求。</p><h2 id="对于耗时请求的临时响应节"><a href="#对于耗时请求的临时响应节" class="headerlink" title="对于耗时请求的临时响应节"></a>对于耗时请求的临时响应节</h2><p>一些请求的处理会需要比较长的时间，比如有时候 DELETE 请求会被安排为稍后处理。在这种情况下，会返回一个 303 (See Other)  重定向响应，该响应链接到一个页面，表示请求的操作已经被列入计划，并且最终会通知用户操作的进展情况，或者允许用户将其取消。</p><h2 id="Nginx中配置重定向"><a href="#Nginx中配置重定向" class="headerlink" title="Nginx中配置重定向"></a>Nginx中配置重定向</h2><figure class="highlight nginx"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="section">server</span> &#123;</div><div class="line">  <span class="attribute">listen</span> <span class="number">80</span>;</div><div class="line">  <span class="attribute">server_name</span> example.com;</div><div class="line">  <span class="attribute">return</span> <span class="number">301</span> <span class="variable">$schema</span>://www.example.com<span class="variable">$request_uri</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>可以使用 rewrite 指令来针对一个文件目录或者一部分页面应用重定向设置：</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">rewrite</span><span class="regexp"> ^/images/(.*)$</span> http://images.example.com/<span class="variable">$1</span> <span class="literal">redirect</span>;</div><div class="line"><span class="attribute">rewrite</span><span class="regexp"> ^/images/(.*)$</span> http://images.example.com/<span class="variable">$1</span> <span class="literal">permanent</span>;</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;Permanent-Redirection-永久重定向&quot;&gt;&lt;a href=&quot;#Permanent-Redirection-永久重定向&quot; class=&quot;headerlink&quot; title=&quot;Permanent Redirection(永久重定向)&quot;&gt;&lt;/a&gt;Perm
      
    
    </summary>
    
      <category term="http" scheme="https://xxxxxmiss.github.io/categories/http/"/>
    
    
      <category term="http" scheme="https://xxxxxmiss.github.io/tags/http/"/>
    
      <category term="redirection" scheme="https://xxxxxmiss.github.io/tags/redirection/"/>
    
  </entry>
  
  <entry>
    <title>platform-compatibility</title>
    <link href="https://xxxxxmiss.github.io/2018/11/13/platform-compatibility/"/>
    <id>https://xxxxxmiss.github.io/2018/11/13/platform-compatibility/</id>
    <published>2018-11-13T03:40:24.000Z</published>
    <updated>2018-11-16T03:49:51.341Z</updated>
    
    <content type="html"><![CDATA[<h2 id="new-Date"><a href="#new-Date" class="headerlink" title="new Date()"></a>new Date()</h2><blockquote><p>如果使用格式化字符串的形式，一般有如下几种形式：</p></blockquote><table><thead><tr><th></th><th>yyyy-MM-dd</th><th>yyyy/MM/dd</th><th>yyyy.MM.dd</th></tr></thead><tbody><tr><td>IOS</td><td>✅</td><td>✅</td><td>❎</td></tr><tr><td>Android</td><td>✅</td><td>✅</td><td>✅</td></tr></tbody></table><p>所以对于<code>yyyy.MM.dd</code>的形式，一般转化成前面2种形式：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">dateStr.replace(<span class="string">'.'</span>, <span class="string">'/'</span>)</div></pre></td></tr></table></figure><p>Note: 经测试发现，如果少了<em>日</em>的字符，也会出现兼容性问题。<br>就比如这种<code>yyyy/MM</code>, 所以为了安全起见，最好这样转化下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (<span class="regexp">/^[\d]&#123;2,4&#125;[-/.]\d&#123;1,2&#125;$/</span>.test(dateStr)) &#123;</div><div class="line">  dateStr.replace(<span class="regexp">/[.-]/g</span>, <span class="string">'/'</span>) + <span class="string">'/01'</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;new-Date&quot;&gt;&lt;a href=&quot;#new-Date&quot; class=&quot;headerlink&quot; title=&quot;new Date()&quot;&gt;&lt;/a&gt;new Date()&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;如果使用格式化字符串的形式，一般有如下几种形式：&lt;/p&gt;

      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>share-miniapp</title>
    <link href="https://xxxxxmiss.github.io/2018/10/20/share-miniapp/"/>
    <id>https://xxxxxmiss.github.io/2018/10/20/share-miniapp/</id>
    <published>2018-10-20T06:22:57.000Z</published>
    <updated>2018-11-14T09:07:01.615Z</updated>
    
    <content type="html"><![CDATA[<h2 id="小程序架构"><a href="#小程序架构" class="headerlink" title="小程序架构"></a><a href="https://www.jianshu.com/p/4e8ed26d3b7a" target="_blank" rel="external">小程序架构</a></h2><img src="/2018/10/20/share-miniapp/miniapp-structure.png" alt="小程序架构" title="小程序架构"><h2 id="JSBridge"><a href="#JSBridge" class="headerlink" title="JSBridge"></a>JSBridge</h2><blockquote><p>JavaScript 是运行在一个单独的 JS Context 中（例如，WebView 的 Webkit 引擎、JSCore）。由于这些 Context 与原生运行环境的天然隔离，我们可以将这种情况与 RPC（Remote Procedure Call，远程过程调用）通信进行类比，将 Native 与 JavaScript 的每次互相调用看做一次 RPC 调用。<br>在 JSBridge 的设计中，可以把前端看做 RPC 的客户端，把 Native 端看做 RPC 的服务器端，从而 JSBridge 要实现的主要逻辑就出现了：通信调用（Native 与 JS 通信） 和 句柄解析调用。（如果你是个前端，而且并不熟悉 RPC 的话，你也可以把这个流程类比成 <a href="#JSONP实现原理">JSONP</a> 的流程）</p></blockquote><img src="/2018/10/20/share-miniapp/jsbridge.png" alt="js桥接" title="js桥接"><p>JavaScript 调用 Native 的方式，主要有两种：注入 API 和 拦截 URL SCHEME。</p><h3 id="注入API"><a href="#注入API" class="headerlink" title="注入API"></a>注入API</h3><p>注入 API 方式的主要原理是，通过 WebView 提供的接口，向 JavaScript 的 Context（window）中注入对象或者方法，让 JavaScript 调用时，直接执行相应的 Native 代码逻辑，达到 JavaScript 调用 Native 的目的。</p><p>IOS:</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">JSContext *context = [uiWebView valueForKeyPath:<span class="string">@"documentView.webView.mainFrame.javaScriptContext"</span>];</div><div class="line"></div><div class="line">context[<span class="string">@"postBridgeMessage"</span>] = ^(<span class="built_in">NSArray</span>&lt;<span class="built_in">NSArray</span> *&gt; *calls) &#123;</div><div class="line">    <span class="comment">// Native 逻辑</span></div><div class="line">&#125;;</div></pre></td></tr></table></figure><p>前端调用</p><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">window</span>.postBridgeMessage(message);</div></pre></td></tr></table></figure><p>Android<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JavaScriptInterfaceDemoActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</div><div class="line">  <span class="keyword">private</span> WebView Wv;</div><div class="line"></div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span></span>&#123;</div><div class="line">      <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line"></div><div class="line">      Wv = (WebView)findViewById(R.id.webView);     </div><div class="line">      <span class="keyword">final</span> JavaScriptInterface myJavaScriptInterface = <span class="keyword">new</span> JavaScriptInterface(<span class="keyword">this</span>);     </div><div class="line"></div><div class="line">      Wv.getSettings().setJavaScriptEnabled(<span class="keyword">true</span>);</div><div class="line">      Wv.addJavascriptInterface(myJavaScriptInterface, <span class="string">"nativeBridge"</span>);</div><div class="line"></div><div class="line">      <span class="comment">// TODO 显示 WebView</span></div><div class="line"></div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JavaScriptInterface</span> </span>&#123;</div><div class="line">        Context mContext;</div><div class="line"></div><div class="line">        JavaScriptInterface(Context c) &#123;</div><div class="line">            mContext = c;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postMessage</span><span class="params">(String webMessage)</span></span>&#123;    </div><div class="line">            <span class="comment">// Native 逻辑</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p><p>前端调用：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">window</span>.nativeBridge.postMessage(message);</div></pre></td></tr></table></figure><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line">&lt;LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"</div><div class="line">    android:layout_width="match_parent"</div><div class="line">    android:layout_height="match_parent"</div><div class="line">    android:orientation="vertical" &gt;</div><div class="line">    &lt;WebView</div><div class="line">      android:id="@+id/webView"</div><div class="line">      android:layout_width="fill_parent"</div><div class="line">      android:layout_height="fill_parent"</div><div class="line">  /&gt;</div><div class="line">&lt;/LinearLayout&gt;</div></pre></td></tr></table></figure><h3 id="拦截URL-SCHEMA"><a href="#拦截URL-SCHEMA" class="headerlink" title="拦截URL SCHEMA"></a>拦截URL SCHEMA</h3><blockquote><p>URL SCHEME：URL SCHEME是一种类似于url的链接，是为了方便app直接互相调用设计的，形式和普通的 url 近似，主要区别是 protocol 和 host 一般是自定义的，例如: qunarhy://hy/url?url=ymfe.tech，protocol 是 qunarhy，host 则是 hy。<br>拦截 URL SCHEME 的主要流程是：Web 端通过某种方式（例如 iframe.src）发送 URL Scheme 请求，之后 Native 拦截到请求并根据 URL SCHEME（包括所带的参数）进行相关操作。</p></blockquote><h3 id="JSBridge雏形"><a href="#JSBridge雏形" class="headerlink" title="JSBridge雏形"></a>JSBridge雏形</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> id = <span class="number">0</span>,</div><div class="line">        callbacks = &#123;&#125;;</div><div class="line"></div><div class="line">    <span class="built_in">window</span>.JSBridge = &#123;</div><div class="line">        <span class="comment">// 调用 Native</span></div><div class="line">        invoke: <span class="function"><span class="keyword">function</span>(<span class="params">bridgeName, callback, data</span>) </span>&#123;</div><div class="line">            <span class="comment">// 判断环境，获取不同的 nativeBridge</span></div><div class="line">            <span class="keyword">var</span> thisId = id ++; <span class="comment">// 获取唯一 id</span></div><div class="line">            callbacks[thisId] = callback; <span class="comment">// 存储 Callback</span></div><div class="line">            nativeBridge.postMessage(&#123;</div><div class="line">                <span class="attr">bridgeName</span>: bridgeName,</div><div class="line">                <span class="attr">data</span>: data || &#123;&#125;,</div><div class="line">                <span class="attr">callbackId</span>: thisId <span class="comment">// 传到 Native 端</span></div><div class="line">            &#125;);</div><div class="line">        &#125;,</div><div class="line">        <span class="attr">receiveMessage</span>: <span class="function"><span class="keyword">function</span>(<span class="params">msg</span>) </span>&#123;</div><div class="line">            <span class="keyword">var</span> bridgeName = msg.bridgeName,</div><div class="line">                data = msg.data || &#123;&#125;,</div><div class="line">                callbackId = msg.callbackId; <span class="comment">// Native 将 callbackId 原封不动传回</span></div><div class="line">            <span class="comment">// 具体逻辑</span></div><div class="line">            <span class="comment">// bridgeName 和 callbackId 不会同时存在</span></div><div class="line">            <span class="keyword">if</span> (callbackId) &#123;</div><div class="line">                <span class="keyword">if</span> (callbacks[callbackId]) &#123; <span class="comment">// 找到相应句柄</span></div><div class="line">                    callbacks[callbackId](msg.data); <span class="comment">// 执行调用</span></div><div class="line">                &#125;</div><div class="line">            &#125; elseif (bridgeName) &#123;</div><div class="line"></div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">&#125;)();</div></pre></td></tr></table></figure><h2 id="JSONP实现原理"><a href="#JSONP实现原理" class="headerlink" title="JSONP实现原理"></a>JSONP实现原理</h2><blockquote><p>听者作答</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">window</span>._callback = <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</div><div class="line">  <span class="comment">// your logic</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> script = <span class="built_in">document</span>.createElement(<span class="string">'script'</span>)</div><div class="line">script.src = <span class="string">`<span class="subst">$&#123;url&#125;</span>&amp;_callback=_callback`</span></div><div class="line"></div><div class="line"><span class="comment">// ...</span></div></pre></td></tr></table></figure><h2 id="JavaScript-与-Objective-C-交互"><a href="#JavaScript-与-Objective-C-交互" class="headerlink" title="JavaScript 与 Objective-C 交互"></a>JavaScript 与 Objective-C 交互</h2><p>主要通过以下2种方式：</p><ul><li>Block: 第一种方式是使用block，block也可以称作闭包和匿名函数，使用block可以很方便的将OC中的单个方法暴露给JS调用，具体实现我们稍后再说。</li><li>JSExport 协议: 第二种方式，是使用JSExport协议，可以将OC的中某个对象直接暴露给JS使用，而且在JS中使用就像调用JS的对象一样自然。</li></ul><p>栗子：通过Block形式</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">context[<span class="string">@"makeNSColor"</span>] = ^(<span class="built_in">NSDictionary</span> *rgb)&#123;</div><div class="line">  <span class="keyword">float</span> r = [colors[<span class="string">@"red"</span>] floatValue];</div><div class="line">  <span class="keyword">float</span> g = [colors[<span class="string">@"green"</span>] floatValue];</div><div class="line">  <span class="keyword">float</span> b = [colors[<span class="string">@"blue"</span>] floatValue];</div><div class="line">  <span class="keyword">return</span> [<span class="built_in">NSColor</span> colorWithRed:(r / <span class="number">255.0</span>)</div><div class="line">    green: (g / <span class="number">255.0</span>f)</div><div class="line">    blue: (b / <span class="number">255.0</span>f)</div><div class="line">    alpha: <span class="number">1.0</span></div><div class="line">  ];</div><div class="line">&#125;;</div></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> colorForWord = <span class="function"><span class="keyword">function</span> (<span class="params">word</span>) </span>&#123;</div><div class="line">  <span class="keyword">if</span> (!colorMap(word)) <span class="keyword">return</span></div><div class="line"></div><div class="line">  <span class="keyword">return</span> makeNSColor(colorMap(word))</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">const</span> colorMap = &#123;</div><div class="line">  <span class="attr">orange</span>: &#123; <span class="attr">red</span>: <span class="number">255</span>, <span class="attr">green</span>: <span class="number">255</span>, <span class="attr">blue</span>: <span class="number">0</span> &#125;,</div><div class="line">  <span class="attr">cyan</span>: &#123; <span class="attr">red</span>: <span class="number">255</span>, <span class="attr">green</span>: <span class="number">155</span>, <span class="attr">blue</span>: <span class="number">0</span> &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><img src="/2018/10/20/share-miniapp/js-oc-call.png" alt="js和oc的相互调用" title="js和oc的相互调用"><img src="/2018/10/20/share-miniapp/js-oc-type.png" alt="js和oc的类型对应关系" title="js和oc的类型对应关系"><h2 id="原生小程序开发痛点："><a href="#原生小程序开发痛点：" class="headerlink" title="原生小程序开发痛点："></a>原生小程序开发痛点：</h2><ul><li>仅支持大部分es2015语法，无法使用es2016+语法（async/await等）</li><li>对于背景图片，无法使用本地路径，需要上传图片至服务器以使用远程地址或者转化为base64编码</li><li>对于直接使用iconfont，需要转换成base64编码</li><li>不支持css预处理器（less, scss, stylus等）</li><li>无法使用eslint等代码检查工具</li><li>对于第三方依赖，需要手动拷贝源代码到项目中，无法直接使用npm包</li><li>…</li><li>总结起来就是无法<em>工程化</em></li></ul><h2 id="优化"><a href="#优化" class="headerlink" title="优化"></a>优化</h2><ul><li>代码压缩</li><li>及时清理无用代码和资源文件（这条已经变得不是很重要了，因为现在没用到的资源并不会被打包）</li><li>减少代码包中的图片等资源文件的大小和数量</li><li>提前请求，但是请求的数据不立即发送到视图层渲染，而是在合适的时机在渲染（<code>setData</code>）</li><li>缓存，利用 storage API 对异步请求数据进行缓存，二次启动时先利用缓存数据渲染页面，在进行后台更新</li><li>分包加载</li></ul><h3 id="分包优点以及限制"><a href="#分包优点以及限制" class="headerlink" title="分包优点以及限制"></a>分包优点以及限制</h3><img src="/2018/10/20/share-miniapp/sub-package.png" alt="分包加载" title="分包加载"><p>优点：</p><blockquote><p>对开发者而言，能使小程序有更大的代码体积，承载更多的功能与服务<br>对用户而言，可以更快地打开小程序，同时在不影响启动速度前提下使用更多功能</p></blockquote><p>限制：</p><blockquote><p>整个小程序所有分包大小不超过 8M<br>单个分包/主包大小不能超过 2M</p></blockquote><h3 id="避免不当使用setData"><a href="#避免不当使用setData" class="headerlink" title="避免不当使用setData"></a>避免不当使用setData</h3><img src="/2018/10/20/share-miniapp/miniapp-render.png" alt="小程序的渲染机制" title="小程序的渲染机制"><ul><li>使用 data 在方法间共享数据，可能增加 setData 传输的数据量。。data 应仅包括与页面渲染相关的数据。</li><li>使用 setData 传输大量数据，<strong>通讯耗时与数据正相关，页面更新延迟可能造成页面更新开销增加。</strong>仅传输页面中发生变化的数据，使用 setData 的特殊 key 实现局部更新。</li><li>短时间内频繁调用 setData，<strong>操作卡顿，交互延迟，阻塞通信，页面渲染延迟。</strong>避免不必要的 setData，对连续的setData调用进行合并。</li><li>在后台页面进行 setData，<strong>抢占前台页面的渲染资源。</strong>页面切入后台后的 setData 调用，延迟到页面重新展示时执行。</li></ul><h3 id="避免不当使用onPageScroll"><a href="#避免不当使用onPageScroll" class="headerlink" title="避免不当使用onPageScroll"></a>避免不当使用onPageScroll</h3><ul><li>只在有必要的时候监听 pageScroll 事件。不监听，则不会派发。</li><li>避免在 onPageScroll 中执行复杂逻辑</li><li>避免在 onPageScroll 中频繁调用 setData</li><li>避免滑动时频繁查询节点信息（SelectQuery）用以判断是否显示，部分场景建议使用节点布局橡胶状态监听（inersectionObserver）替代</li></ul><h2 id="小程序开发框架比较"><a href="#小程序开发框架比较" class="headerlink" title="小程序开发框架比较"></a>小程序开发框架比较</h2><img src="/2018/10/20/share-miniapp/framework-comparison.png" alt="小程序开发框架比较" title="小程序开发框架比较"><h2 id="各大框架的转化原理（以taro为例）"><a href="#各大框架的转化原理（以taro为例）" class="headerlink" title="各大框架的转化原理（以taro为例）"></a>各大框架的转化原理（以taro为例）</h2><img src="/2018/10/20/share-miniapp/taro-build.png" alt="taro转化原理" title="taro转化原理"><h2 id="各大框架相关链接"><a href="#各大框架相关链接" class="headerlink" title="各大框架相关链接"></a>各大框架相关链接</h2><h3 id="Taro"><a href="#Taro" class="headerlink" title="Taro"></a><a href="https://nervjs.github.io/taro/doc/router.html" target="_blank" rel="external">Taro</a></h3><blockquote><p><a href="https://github.com/NervJS/taro/issues" target="_blank" rel="external">官方仓库</a></p></blockquote><ul><li><a href="https://aotu.io/notes/2018/06/07/Taro/index.html" target="_blank" rel="external">Related</a></li></ul><h3 id="nanachi"><a href="#nanachi" class="headerlink" title="nanachi"></a><a href="https://rubylouvre.github.io/nanachi/index.html" target="_blank" rel="external">nanachi</a></h3><blockquote><p><a href="https://github.com/RubyLouvre/anu/tree/master/packages/cli" target="_blank" rel="external">官方仓库</a></p></blockquote><h3 id="mpvue"><a href="#mpvue" class="headerlink" title="mpvue"></a><a href="http://mpvue.com/" target="_blank" rel="external">mpvue</a></h3><blockquote><p><a href="https://github.com/Meituan-Dianping/mpvue/issues" target="_blank" rel="external">官方仓库</a></p></blockquote><h3 id="megalo"><a href="#megalo" class="headerlink" title="megalo"></a><a href="https://kaola-fed.github.io/megalo-docs/#/" target="_blank" rel="external">megalo</a></h3><blockquote><p><a href="https://github.com/kaola-fed/megalo/issues" target="_blank" rel="external">官方仓库</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;小程序架构&quot;&gt;&lt;a href=&quot;#小程序架构&quot; class=&quot;headerlink&quot; title=&quot;小程序架构&quot;&gt;&lt;/a&gt;&lt;a href=&quot;https://www.jianshu.com/p/4e8ed26d3b7a&quot; target=&quot;_blank&quot; rel=&quot;e
      
    
    </summary>
    
      <category term="前端" scheme="https://xxxxxmiss.github.io/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
      <category term="小程序" scheme="https://xxxxxmiss.github.io/tags/%E5%B0%8F%E7%A8%8B%E5%BA%8F/"/>
    
      <category term="Hybrid开发" scheme="https://xxxxxmiss.github.io/tags/Hybrid%E5%BC%80%E5%8F%91/"/>
    
  </entry>
  
  <entry>
    <title>css-border-radius</title>
    <link href="https://xxxxxmiss.github.io/2018/04/02/css-border-radius/"/>
    <id>https://xxxxxmiss.github.io/2018/04/02/css-border-radius/</id>
    <published>2018-04-02T07:30:11.000Z</published>
    <updated>2018-04-02T07:37:02.834Z</updated>
    
    <content type="html"><![CDATA[<h2 id="border-radius"><a href="#border-radius" class="headerlink" title="border-radius"></a>border-radius</h2><blockquote><p>如果一个父元素设置<code>border-radius</code>,子元素占据该父元素的<code>100%</code>,<br>但是该子元素并未设置<code>border-radius</code>,那么父元素的<code>border-radius</code>会被盖住（也就是说视觉上根本就跟父元素没有设置 <code>border-radius</code>一样）</p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;border-radius&quot;&gt;&lt;a href=&quot;#border-radius&quot; class=&quot;headerlink&quot; title=&quot;border-radius&quot;&gt;&lt;/a&gt;border-radius&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;如果一个父元素设置&lt;cod
      
    
    </summary>
    
      <category term="front-end" scheme="https://xxxxxmiss.github.io/categories/front-end/"/>
    
    
      <category term="css" scheme="https://xxxxxmiss.github.io/tags/css/"/>
    
      <category term="border-radius" scheme="https://xxxxxmiss.github.io/tags/border-radius/"/>
    
  </entry>
  
  <entry>
    <title>git-commit-rules</title>
    <link href="https://xxxxxmiss.github.io/2018/03/16/git-commit-rules/"/>
    <id>https://xxxxxmiss.github.io/2018/03/16/git-commit-rules/</id>
    <published>2018-03-16T08:21:48.000Z</published>
    <updated>2018-10-20T07:27:37.257Z</updated>
    
    <content type="html"><![CDATA[<h2 id="git日志提交规范"><a href="#git日志提交规范" class="headerlink" title="git日志提交规范"></a>git日志提交规范</h2><blockquote><p>格式如下：</p></blockquote><figure class="highlight fortran"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;<span class="keyword">type</span>&gt;[<span class="keyword">optional</span> scope]: &lt;description&gt;</div><div class="line"></div><div class="line">[<span class="keyword">optional</span> body]</div><div class="line"></div><div class="line">[<span class="keyword">optional</span> footer]</div></pre></td></tr></table></figure><h3 id="fix-bug"><a href="#fix-bug" class="headerlink" title="fix(:bug:)"></a>fix(:bug:)</h3><blockquote><p>修复问题，对应<code>semver patch</code><br>fix: named slots for nested functional components</p><p>指定具体的模块，功能等</p></blockquote><ul><li>fix(core)</li><li>fix(ssr)</li><li>fix(model)</li><li>fix(keep-alive)</li></ul><h3 id="feat-sparkles"><a href="#feat-sparkles" class="headerlink" title="feat(:sparkles:)"></a>feat(:sparkles:)</h3><blockquote><p>增加新的特征，功能，对应<code>semver minor</code><br>feat(weex): support sending style sheets and class list to native</p></blockquote><h3 id="BREAKING-CHANGE"><a href="#BREAKING-CHANGE" class="headerlink" title="BREAKING CHANGE"></a>BREAKING CHANGE</h3><blockquote><p>内容发生重大改变，对应<code>semver major</code><br>BREAKING CHANGE: environment variables now take precedence over config files</p></blockquote><h3 id="build"><a href="#build" class="headerlink" title="build"></a>build</h3><blockquote><p>构建版本<br>build: release 2.5.15</p></blockquote><h3 id="test"><a href="#test" class="headerlink" title="test"></a>test</h3><blockquote><p>测试相关<br>test(vdom): add test case for #7786 (#7793)</p></blockquote><h3 id="types"><a href="#types" class="headerlink" title="types"></a>types</h3><blockquote><p>当使用<code>type script</code>的时候，如果修改的内容和types相关。<br>types: add Fragment in RenderState typing (#7802)</p></blockquote><h3 id="workflow"><a href="#workflow" class="headerlink" title="workflow"></a>workflow</h3><blockquote><p>有关工作流的修改<br>workflow: specify e2e env when releasing<br>workflow: remove setup script</p></blockquote><h3 id="chore"><a href="#chore" class="headerlink" title="chore"></a>chore</h3><blockquote><p>一些杂活，比如更新赞助者，重新组织代码贡献者<br>chore: coverage<br>chore: update sponsors<br>chore: re-organize backers.md</p></blockquote><h3 id="refactor"><a href="#refactor" class="headerlink" title="refactor"></a>refactor</h3><blockquote><p>重构代码<br>refactor: observerState</p><p>重构具体的模块<br>refactor(core): remove unnecessary switch case (#5971) </p></blockquote><h3 id="docs-memo"><a href="#docs-memo" class="headerlink" title="docs(:memo:)"></a>docs(:memo:)</h3><blockquote><p>有关文档的修改<br>docs: update Angular’s commit convention link (#7666)</p></blockquote><h3 id="ci"><a href="#ci" class="headerlink" title="ci"></a>ci</h3><blockquote><p>相关工具的修改，比如<code>vue-cli</code><br>ci: use latest version of codecov binary (#7665) </p></blockquote><h3 id="polish"><a href="#polish" class="headerlink" title="polish"></a>polish</h3><blockquote><p>美化代码<br>polish: raise warning when Vue.set/delete is called on invalid values</p></blockquote><h3 id="revert"><a href="#revert" class="headerlink" title="revert"></a>revert</h3><blockquote><p>版本回退<br>revert(weex): remove the “receiveTasks” api and support component hook</p></blockquote><h3 id="perf-zap"><a href="#perf-zap" class="headerlink" title="perf(:zap:)"></a>perf(:zap:)</h3><blockquote><p>优化性能<br>perf(v-model): tweak setSelected</p></blockquote><p><a href="https://github.com/conventional-changelog/conventional-changelog" target="_blank" rel="external">Conventional Changelog Ecosystem</a><br><a href="https://semver.org/#spec-item-9" target="_blank" rel="external">semantic versioning</a><br><a href="https://conventionalcommits.org/" target="_blank" rel="external">git conventional commits</a><br><a href="https://www.webpagefx.com/tools/emoji-cheat-sheet/" target="_blank" rel="external">git emojis</a></p><h2 id="使用commitlint校验本地提交信息"><a href="#使用commitlint校验本地提交信息" class="headerlink" title="使用commitlint校验本地提交信息"></a>使用<code>commitlint</code>校验本地提交信息</h2><p>安装包<br><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">npm</span> i @commitlint/cli @commitlint/config-conventional husky --save-dev</div></pre></td></tr></table></figure></p><p>在项目的根目录下新建<code>commitlint.config.js</code><br><figure class="highlight ceylon"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">module</span>.exports = &#123;<span class="keyword">extends</span>: [<span class="string">'@commitlint/config-conventional'</span>]&#125;</div></pre></td></tr></table></figure></p><p>在<code>scripts</code>中添加如下<code>script</code><br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"scripts"</span>: &#123;</div><div class="line">    <span class="attr">"commitmsg"</span>: <span class="string">"commitlint -e $GIT_PARAMS"</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p><h2 id="使用commitizen交互式窗口生成约定的提交信息"><a href="#使用commitizen交互式窗口生成约定的提交信息" class="headerlink" title="使用commitizen交互式窗口生成约定的提交信息"></a>使用<code>commitizen</code>交互式窗口生成约定的提交信息</h2><h3 id="作为项目依赖安装使用"><a href="#作为项目依赖安装使用" class="headerlink" title="作为项目依赖安装使用"></a>作为项目依赖安装使用</h3><figure class="highlight q"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm i commitizen cz-conventional-changelog --<span class="built_in">save</span>-<span class="built_in">dev</span></div></pre></td></tr></table></figure><p>package.json配置<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"scripts"</span>: &#123;</div><div class="line">    <span class="attr">"commit"</span>: <span class="string">"git-cz"</span></div><div class="line">  &#125;,</div><div class="line">  <span class="attr">"config"</span>: &#123;</div><div class="line">    <span class="attr">"commitizen"</span>: &#123;</div><div class="line">      <span class="attr">"path"</span>: <span class="string">"cz-conventional-changelog"</span></div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p><p>然后每次提交的时候，使用<code>npm run commit</code>代替<code>git commit</code>。</p><h3 id="作为全局安装使用"><a href="#作为全局安装使用" class="headerlink" title="作为全局安装使用"></a>作为全局安装使用</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm i -g commitizen cz-conventional-changelog</div></pre></td></tr></table></figure><p>创建commitizen配置文件：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">echo</span> <span class="string">'&#123; "path": "cz-conventional-changelog" &#125;'</span> &gt; ~/.czrc</div></pre></td></tr></table></figure></p><p>现在每次提交的时候就可以使用<code>git cz</code>代替<code>git commit</code>。<br><code>git cz</code><strong>支持和</strong><code>git commit</code><strong>一样的选项，如：git cz -a</strong>。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;git日志提交规范&quot;&gt;&lt;a href=&quot;#git日志提交规范&quot; class=&quot;headerlink&quot; title=&quot;git日志提交规范&quot;&gt;&lt;/a&gt;git日志提交规范&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;格式如下：&lt;/p&gt;
&lt;/blockquote&gt;
&lt;figu
      
    
    </summary>
    
      <category term="版本管理" scheme="https://xxxxxmiss.github.io/categories/%E7%89%88%E6%9C%AC%E7%AE%A1%E7%90%86/"/>
    
    
      <category term="git" scheme="https://xxxxxmiss.github.io/tags/git/"/>
    
  </entry>
  
  <entry>
    <title>make</title>
    <link href="https://xxxxxmiss.github.io/2018/03/14/make/"/>
    <id>https://xxxxxmiss.github.io/2018/03/14/make/</id>
    <published>2018-03-14T06:42:07.000Z</published>
    <updated>2018-03-14T06:55:54.682Z</updated>
    
    <content type="html"><![CDATA[<h2 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h2><ul><li>以点（.）开头并且全部是大写字母的变量，有特殊的意义。</li><li>大小写敏感。</li><li>通过<code>${var}</code>,<code>$(var)</code>来引用一个变量</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;变量&quot;&gt;&lt;a href=&quot;#变量&quot; class=&quot;headerlink&quot; title=&quot;变量&quot;&gt;&lt;/a&gt;变量&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;以点（.）开头并且全部是大写字母的变量，有特殊的意义。&lt;/li&gt;
&lt;li&gt;大小写敏感。&lt;/li&gt;
&lt;li&gt;通过&lt;code&gt;${v
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>shell-command</title>
    <link href="https://xxxxxmiss.github.io/2018/03/08/shell-command/"/>
    <id>https://xxxxxmiss.github.io/2018/03/08/shell-command/</id>
    <published>2018-03-07T16:48:17.000Z</published>
    <updated>2018-03-07T17:10:40.984Z</updated>
    
    <content type="html"><![CDATA[<h2 id="id"><a href="#id" class="headerlink" title="id"></a>id</h2><blockquote><p>查看用户属性</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># 打印当前用户的uid, 用户名, gid, 组名等相关信息</div><div class="line">$ id</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># 打印uid</div><div class="line">$ id -u</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># 打印gid</div><div class="line">$ id -g</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># 打印用户名</div><div class="line">$ id -un</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># 打印组名</div><div class="line">$ id -gn</div></pre></td></tr></table></figure><h2 id="amp-符号"><a href="#amp-符号" class="headerlink" title="&amp;符号"></a>&amp;符号</h2><blockquote><p><code>&amp;</code>是Bash内置的用于并行处理进程的一个控制操作符。在命令行的末尾添加<code>&amp;</code>将会在后台运行该命令，它将在当前的Shell进行下启动一个子Shell进程。</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ sleep 10 &amp;</div><div class="line"># 输出任务编号和子进程号</div><div class="line">[1] 22525</div></pre></td></tr></table></figure><p>通过<code>jobs</code>命令来查看后台正在运行的任务信息：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ jobs</div><div class="line">[1]  + running    sleep 10</div></pre></td></tr></table></figure></p><p>通过<code>-l</code>选项可以查看正在后台运行的任务的进程号等信息<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ jobs -l</div><div class="line">[1]  + 22711 running    sleep 10</div></pre></td></tr></table></figure></p><p>通过<code>%任务编号</code>或者<code>fg 任务编号</code>可以将后台任务切换到前台：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ sleep 30 &amp;</div><div class="line">[1] 22711</div><div class="line">$ %1</div></pre></td></tr></table></figure></p><p>通过以下几个步骤可以将任务在前后台间切换：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$ sleep 30 &amp;</div><div class="line">$ %1</div><div class="line">$ CTRL + Z组合键</div><div class="line"># 或者使用bg</div><div class="line">$ %1 &amp;</div></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;id&quot;&gt;&lt;a href=&quot;#id&quot; class=&quot;headerlink&quot; title=&quot;id&quot;&gt;&lt;/a&gt;id&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;查看用户属性&lt;/p&gt;
&lt;/blockquote&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>docker</title>
    <link href="https://xxxxxmiss.github.io/2018/03/06/docker/"/>
    <id>https://xxxxxmiss.github.io/2018/03/06/docker/</id>
    <published>2018-03-06T15:58:01.000Z</published>
    <updated>2018-11-23T09:24:01.734Z</updated>
    
    <content type="html"><![CDATA[<h2 id="docker-简介"><a href="#docker-简介" class="headerlink" title="docker 简介"></a>docker 简介</h2><blockquote><p>docker 是一个开发，运输，运行程序的一个平台。docker 将你的程序和基础设施隔离开来，以便于快速的运输，测试，开发。</p></blockquote><h2 id="docker-引擎"><a href="#docker-引擎" class="headerlink" title="docker 引擎"></a>docker 引擎</h2><blockquote><p><a href="https://docs.docker.com/engine/docker-overview/#the-docker-platform" target="_blank" rel="external">官方传送门</a></p></blockquote><h2 id="docker-架构（体系结构）"><a href="#docker-架构（体系结构）" class="headerlink" title="docker 架构（体系结构）"></a>docker 架构（体系结构）</h2><blockquote><p>使用<code>client-server</code>架构，docker 客户端告诉 daemon(docker 后台常驻进程)去做一个<strong>构建，运行，分发</strong>docker 容器。<br>docker 客户端和 daemon 的交流通信使用<code>rest api</code>，基于一个<code>unix socket</code>或者<code>network interface</code>之上。</p></blockquote><h3 id="几个术语（glossary）"><a href="#几个术语（glossary）" class="headerlink" title="几个术语（glossary）"></a>几个术语（glossary）</h3><ul><li><p><code>Docker registries</code>: docker 镜像源，docker 默认被配置为去<code>docker hub</code>上下载镜像。</p></li><li><p><code>images</code>: 镜像，一个镜像是带有一系列指令的只读的模板(包)，用来创建 docker 容器。当你创建自己的镜像的时候，你需要在<code>Dockerfile</code>中按照一定的简单的语法去定义一些步骤去创建镜像并运行它。<br>一个镜像包含了运行一个程序所需要的各种依赖（代码，运行时，库，环境变量，配置文件）。<br><code>Dockerfile</code>中的每一条指令都会生成一个<strong>层</strong>。</p></li><li><p><code>containers</code>: 容器，一个容器是一个镜像的可运行的实例。可以通过<code>docker api</code>或则<code>CLI</code>对实例进行<code>CRUD</code>等操作。</p></li><li><p><code>services</code>: 服务，服务允许你跨多个 daemon 扫描容器，这些 daemon 相互协作称之为一个集群（swarm）。</p></li></ul><h2 id="docker-基本开发环境搭建"><a href="#docker-基本开发环境搭建" class="headerlink" title="docker 基本开发环境搭建"></a>docker 基本开发环境搭建</h2><h3 id="容器（containers）"><a href="#容器（containers）" class="headerlink" title="容器（containers）"></a>容器（containers）</h3><ul><li>使用<code>Dockerfile</code>定义容器</li></ul><p>Dockerfile</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Use an official Python runtime as a parent image</span></div><div class="line"><span class="keyword">FROM</span> python:<span class="number">2.7</span>-slim</div><div class="line"></div><div class="line"><span class="comment"># Set the working directory to /app</span></div><div class="line"><span class="keyword">WORKDIR</span><span class="bash"> /app</span></div><div class="line"></div><div class="line"><span class="comment"># Copy the current directory contents into the container at /app</span></div><div class="line"><span class="keyword">ADD</span><span class="bash"> . /app</span></div><div class="line"></div><div class="line"><span class="comment"># Install any needed packages specified in requirements.txt</span></div><div class="line"><span class="keyword">RUN</span><span class="bash"> pip install --trusted-host pypi.python.org -r requirements.txt</span></div><div class="line"></div><div class="line"><span class="comment"># Make port 80 available to the world outside this container</span></div><div class="line"><span class="keyword">EXPOSE</span> <span class="number">80</span></div><div class="line"></div><div class="line"><span class="comment"># Define environment variable</span></div><div class="line"><span class="keyword">ENV</span> NAME World</div><div class="line"></div><div class="line"><span class="comment"># Run app.py when the container launches</span></div><div class="line"><span class="keyword">CMD</span><span class="bash"> [<span class="string">"python"</span>, <span class="string">"app.py"</span>]</span></div></pre></td></tr></table></figure><p>app.py</p><figure class="highlight nix"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">from flask <span class="built_in">import</span> Flask</div><div class="line">from redis <span class="built_in">import</span> Redis, RedisError</div><div class="line"><span class="built_in">import</span> os</div><div class="line"><span class="built_in">import</span> socket</div><div class="line"></div><div class="line"><span class="comment"># Connect to Redis</span></div><div class="line"><span class="attr">redis</span> = Redis(<span class="attr">host="redis",</span> <span class="attr">db=0,</span> <span class="attr">socket_connect_timeout=2,</span> <span class="attr">socket_timeout=2)</span></div><div class="line"></div><div class="line"><span class="attr">app</span> = Flask(__name__)</div><div class="line"></div><div class="line">@app.route(<span class="string">"/"</span>)</div><div class="line">def hello():</div><div class="line">    try:</div><div class="line">        <span class="attr">visits</span> = redis.incr(<span class="string">"counter"</span>)</div><div class="line">    except RedisError:</div><div class="line">        <span class="attr">visits</span> = <span class="string">"&lt;i&gt;cannot connect to Redis, counter disabled&lt;/i&gt;"</span></div><div class="line"></div><div class="line">    <span class="attr">html</span> = <span class="string">"&lt;h3&gt;Hello &#123;name&#125;!&lt;/h3&gt;"</span> \</div><div class="line">           <span class="string">"&lt;b&gt;Hostname:&lt;/b&gt; &#123;hostname&#125;&lt;br/&gt;"</span> \</div><div class="line">           <span class="string">"&lt;b&gt;Visits:&lt;/b&gt; &#123;visits&#125;"</span></div><div class="line">    return html.format(<span class="attr">name=os.getenv("NAME",</span> <span class="string">"world"</span>), <span class="attr">hostname=socket.gethostname(),</span> <span class="attr">visits=visits)</span></div><div class="line"></div><div class="line"><span class="keyword">if</span> <span class="attr">__name__</span> == <span class="string">"__main__"</span>:</div><div class="line">    app.run(<span class="attr">host='0.0.0.0',</span> <span class="attr">port=80)</span></div></pre></td></tr></table></figure><ul><li>构建 docker 镜像</li></ul><figure class="highlight armasm"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ docker <span class="keyword">build </span>-t friendlyhello .</div></pre></td></tr></table></figure><ul><li>查看上一步构建的镜像</li></ul><figure class="highlight mel"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ docker <span class="keyword">image</span> <span class="keyword">ls</span></div></pre></td></tr></table></figure><ul><li>运行 app</li></ul><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ docker <span class="keyword">run</span><span class="bash"> -p 4000:80 friendlyhello</span></div></pre></td></tr></table></figure><ul><li>查看 app.py 的输出<br>在浏览器访问<code>http://localhost:4000</code>或者<br>在终端使用 curl 查看：</li></ul><figure class="highlight gams"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="symbol">$</span> curl http:<span class="comment">//localhost:4000</span></div></pre></td></tr></table></figure><ul><li>查看运行中的容器</li></ul><figure class="highlight mel"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ docker <span class="keyword">container</span> <span class="keyword">ls</span></div></pre></td></tr></table></figure><ul><li>停止运行一个容器</li></ul><figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ docker container <span class="keyword">stop</span> <span class="symbol">&lt;IMAGE_ID&gt;</span></div></pre></td></tr></table></figure><h3 id="服务（services）"><a href="#服务（services）" class="headerlink" title="服务（services）"></a>服务（services）</h3><blockquote><p>一个服务只会运行一个镜像，但是它定义了镜像运行的法规：比如该使用什么端口，产生多少个容器的复制品。<br>关于服务的概念比较的抽象，可以查看<a href="https://docs.docker.com/get-started/part3/#about-services" target="_blank" rel="external">官方例子对于服务的解释</a></p></blockquote><p>task:</p><blockquote><p>一个 service 中运行的一个容器叫做 task。task 被给予一个自增的 id,增加到<code>replicas</code>的数量位置。<br>查看 service 中的 tasks</p><p>一个<code>docker-compose.yml</code>文件定义了 docker 容器在产品模式下应该具有的行为。</p></blockquote><figure class="highlight less"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">version</span>: <span class="string">"3"</span></div><div class="line"><span class="attribute">services</span>:</div><div class="line">  <span class="attribute">web</span>:</div><div class="line">    # replace username/<span class="attribute">repo</span>:tag with your name and image details</div><div class="line">    <span class="attribute">image</span>: username/<span class="attribute">repo</span>:tag</div><div class="line">    <span class="attribute">deploy</span>:</div><div class="line">      <span class="attribute">replicas</span>: <span class="number">5</span></div><div class="line">      <span class="attribute">resources</span>:</div><div class="line">        <span class="attribute">limits</span>:</div><div class="line">          <span class="attribute">cpus</span>: <span class="string">"0.1"</span></div><div class="line">          <span class="attribute">memory</span>: <span class="number">50</span>M</div><div class="line">      <span class="attribute">restart_policy</span>:</div><div class="line">        <span class="attribute">condition</span>: on-failure</div><div class="line">    <span class="attribute">ports</span>:</div><div class="line">      - <span class="string">"80:80"</span></div><div class="line">    <span class="attribute">networks</span>:</div><div class="line">      - webnet</div><div class="line"><span class="attribute">networks</span>:</div><div class="line">  <span class="attribute">webnet</span>:</div></pre></td></tr></table></figure><p>运行我们的服务：</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ docker stack deploy -c docker-compose<span class="selector-class">.yml</span> getstartedlab</div></pre></td></tr></table></figure><p>在使用上面的命令来启动一个服务的时候，必须先设置一个<code>swarm manager</code>（集群 leader）, 不然会抛出一个错误提示。后面解释为什么要这样做：</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$ </span>docker swarm init</div></pre></td></tr></table></figure><p>查看启动的服务：</p><figure class="highlight vala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ docker service ls</div><div class="line"><span class="meta"># 通过该命令查看，可以看出该服务的名称为 getstartedlab_web</span></div><div class="line"><span class="meta"># getstartedlab是你在上一个命令中定义的app的名称</span></div><div class="line"><span class="meta"># web是你在docker-compose.yaml中定义的服务名称</span></div></pre></td></tr></table></figure><p>列出一个服务中有多少个任务：</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">docker</span> service ps getstartedlab_web</div></pre></td></tr></table></figure><p>请求服务：</p><figure class="highlight vala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ curl <span class="number">-4</span> http:<span class="comment">//localhost</span></div><div class="line"><span class="meta"># 或者在浏览器中打开并刷新几次，可以看到Hostname在改变</span></div></pre></td></tr></table></figure><p>扫描 app: 可以改变<code>docker-compose.yml</code>中的相关配置，然后重新运行发布命令</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ docker stack deploy -c docker-compose<span class="selector-class">.yml</span> getstartedlab</div></pre></td></tr></table></figure><p>拆卸 app 和 swarm</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$ </span>docker stack rm getstartedlab</div><div class="line"><span class="variable">$ </span>docker swarm leave --force</div></pre></td></tr></table></figure><h3 id="Stacks-栈"><a href="#Stacks-栈" class="headerlink" title="Stacks(栈)"></a>Stacks(栈)</h3><blockquote><p>栈是一组相互关联的服务，这些服务可以共享依赖关系,被组织和缩放。一个栈有着定义和协调整个应用的能力。</p></blockquote><h2 id="Dockerfile-常用指令（选项）"><a href="#Dockerfile-常用指令（选项）" class="headerlink" title="Dockerfile 常用指令（选项）"></a>Dockerfile 常用指令（选项）</h2><p><a href="https://docs.docker.com/engine/reference/builder/" target="_blank" rel="external">官方传送门</a></p><blockquote><p><code>Dockerfile</code>中的指令大小写不敏感，但是按照约定都使用大写，以便于和指定的参数区分。<br><code>Dockerfile</code>中的指令按顺序一条一条的执行，并且<code>Dockerfile</code>文件必须以<code>FROM</code>开始</p></blockquote><h3 id="构建上下文-context"><a href="#构建上下文-context" class="headerlink" title="构建上下文 context"></a>构建上下文 context</h3><blockquote><p><code>docker build</code>命令基于<code>Dockerfile</code>文件和<code>context</code>构建镜像。<br><code>context</code>是一个<code>PATH</code>或则<code>URL</code>指定的文件集合。<br><code>PATH</code>是一个本地文件系统的一个目录，<code>URL</code>是一个 git 仓库。</p></blockquote><h3 id="dockerignore"><a href="#dockerignore" class="headerlink" title=".dockerignore"></a><code>.dockerignore</code></h3><blockquote><p>为了增加构建的性能，可以将不需要的文件添加到<code>.dockerignore</code></p></blockquote><p>一般情况下，<code>Dockerfile</code>放置在<code>context</code>的根目录下，可以使用<code>-f</code>选项指定<code>Dockerfile</code>文件的位置：</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ docker <span class="keyword">build</span> -f /<span class="keyword">path</span>/<span class="keyword">to</span>/a/Dockerfile .</div></pre></td></tr></table></figure><p>可以为一个镜像指定多个仓库标签:</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ docker <span class="keyword">build </span>-t <span class="keyword">shykes/myapp:1.0.2 </span>-t <span class="keyword">shykes/myapp:latest </span>.</div></pre></td></tr></table></figure><h3 id="解析器指令（parser-directives）"><a href="#解析器指令（parser-directives）" class="headerlink" title="解析器指令（parser directives）"></a>解析器指令（parser directives）</h3><blockquote><p><code>Dockerfile</code>中的注释已<code>#</code>开头，但是解析器指令时一种特殊的注释，必须出现在<code>Dockerfile</code>中的开头部分。<br>语法：# directive=value</p></blockquote><h3 id="FROM"><a href="#FROM" class="headerlink" title="FROM"></a>FROM</h3><blockquote><p>初始化一个新的构建时期，为接下来的指令设置一个<a href="https://docs.docker.com/glossary/" target="_blank" rel="external">基本镜像</a>。<br>常用的 3 种形式：</p></blockquote><figure class="highlight sqf"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">FROM</span> &lt;<span class="built_in">image</span>&gt; [AS &lt;<span class="built_in">name</span>&gt;]</div><div class="line"><span class="keyword">FROM</span> &lt;<span class="built_in">image</span>&gt;[:&lt;tag&gt;] [AS &lt;<span class="built_in">name</span>&gt;]</div><div class="line"><span class="keyword">FROM</span> &lt;<span class="built_in">image</span>&gt;[@&lt;digest&gt;] [AS &lt;<span class="built_in">name</span>&gt;]</div></pre></td></tr></table></figure><h3 id="RUN"><a href="#RUN" class="headerlink" title="RUN"></a>RUN</h3><blockquote><p>在当前镜像的顶部新的层里运行任何指令，并将结果提交到下一步中。<br>层运行指令并且生成提交信息符合<code>Docker</code>的核心概念：这个提交是非常便宜的，容器可以基于一个镜像的任何历史点创建。<br>2 种使用形式：shell 形式和 exec 形式</p></blockquote><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">RUN</span><span class="bash"> /bin/bash -c <span class="string">'source $HOME/.bashrc; \</span></span></div><div class="line">echo $HOME'</div><div class="line"><span class="comment"># exec形式必须使用双引号（""）</span></div><div class="line"><span class="keyword">RUN</span><span class="bash"> [<span class="string">"/bin/bash"</span>, <span class="string">"-c"</span>, <span class="string">"echo hello"</span>]</span></div></pre></td></tr></table></figure><h3 id="CMD"><a href="#CMD" class="headerlink" title="CMD"></a>CMD</h3><blockquote><p>一个<code>Dockerfile</code>中只能出现一个<code>CMD</code>,如果出现了多个，那么只有最后一个起作用。<br>3 种使用形式：</p></blockquote><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># exec形式，最受欢迎的形式</span></div><div class="line"><span class="keyword">CMD</span><span class="bash"> [<span class="string">"executable"</span>,<span class="string">"param1"</span>,<span class="string">"param2"</span>]</span></div><div class="line"></div><div class="line"><span class="comment"># 作为默认值传递到 entrypoint</span></div><div class="line"><span class="keyword">CMD</span><span class="bash"> [<span class="string">"param1"</span>,<span class="string">"param2"</span>]</span></div><div class="line"></div><div class="line"><span class="comment"># shell形式</span></div><div class="line"><span class="keyword">CMD</span><span class="bash"> <span class="built_in">command</span> param1 param2</span></div></pre></td></tr></table></figure><h3 id="LABEL"><a href="#LABEL" class="headerlink" title="LABEL"></a>LABEL</h3><blockquote><p>为镜像添加一些元数据，可以使用<code>docker inspect</code>查看 label 的值。使用形式:</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">LABEL <span class="tag">&lt;<span class="name">key</span>&gt;</span>=<span class="tag">&lt;<span class="name">value</span>&gt;</span> <span class="tag">&lt;<span class="name">key</span>&gt;</span>=<span class="tag">&lt;<span class="name">value</span>&gt;</span> <span class="tag">&lt;<span class="name">key</span>&gt;</span>=<span class="tag">&lt;<span class="name">value</span>&gt;</span> ...</div></pre></td></tr></table></figure><p>一些常用情况的例子</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">LABEL</span><span class="bash"> <span class="string">"com.example.vendor"</span>=<span class="string">"ACME Incorporated"</span></span></div><div class="line"><span class="keyword">LABEL</span><span class="bash"> com.example.label-with-value=<span class="string">"foo"</span></span></div><div class="line"><span class="keyword">LABEL</span><span class="bash"> version=<span class="string">"1.0"</span></span></div><div class="line"><span class="keyword">LABEL</span><span class="bash"> description=<span class="string">"This text illustrates \</span></span></div><div class="line">that label-values can span multiple lines."</div></pre></td></tr></table></figure><h3 id="MAINTAINER"><a href="#MAINTAINER" class="headerlink" title="MAINTAINER"></a><del>MAINTAINER</del></h3><blockquote><p>已过期，使用<code>LABEL</code>代替。</p></blockquote><h3 id="EXPOSE"><a href="#EXPOSE" class="headerlink" title="EXPOSE"></a>EXPOSE</h3><blockquote><p>指定 docker 容器在运行的时候监听那个网络端口，可以指定使用 TCP 还是 DUP。如果没有指定协议，默认使用 TCP。使用形式：</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">EXPOSE <span class="tag">&lt;<span class="name">port</span>&gt;</span> [<span class="tag">&lt;<span class="name">port</span>&gt;</span>/<span class="tag">&lt;<span class="name">protocol</span>&gt;</span>...]</div></pre></td></tr></table></figure><h3 id="ENV"><a href="#ENV" class="headerlink" title="ENV"></a>ENV</h3><blockquote><p>可以使用<code>docker inspect</code>查看它的值，<br>可以使用<code>docker run --env &lt;key&gt;=&lt;value&gt;</code>改变值。<br>环境变量持久化可能会带来一些副作用，所以可以通过<code>RUN &lt;key&gt;=&lt;value&gt; &lt;command&gt;</code>来设置单个指令变量。<br>使用形式：</p></blockquote><figure class="highlight dts"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta"># 设置单个值的形式，key后面的第一个空格后面的所有字符（包括空格，引号等）都被设置为&lt;value&gt;</span></div><div class="line">ENV <span class="params">&lt;key&gt;</span> <span class="params">&lt;value&gt;</span></div><div class="line"></div><div class="line"><span class="meta"># 可以设置多个值</span></div><div class="line">ENV <span class="params">&lt;key&gt;</span>=<span class="params">&lt;value&gt;</span> ...</div></pre></td></tr></table></figure><p>如：</p><figure class="highlight livescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ENV myName=<span class="string">"John Doe"</span> myDog=Rex<span class="string">\</span> The<span class="string">\</span> Dog <span class="string">\</span></div><div class="line">    myCat=fluffy</div></pre></td></tr></table></figure><p>等价于</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">ENV</span> myname John Doe</div><div class="line"><span class="keyword">ENV</span> myDog Rex The Dog</div><div class="line"><span class="keyword">ENV</span> myCat fluffy</div></pre></td></tr></table></figure><h3 id="ADD"><a href="#ADD" class="headerlink" title="ADD"></a>ADD</h3><blockquote><p>该指令将<code>src</code>中的文件，文件夹或者远程文件拷贝到镜像所在的文件系统的<code>dest</code>目录。<br><code>src</code>中的路径被解析为相对于构建上下文<code>context</code>的路径，路径中可包含通配符。<br><code>dest</code>路径必须是一个绝对路径或者相对于<code>WORKDIR</code>的路径。<br>使用形式：</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ADD [--chown=<span class="tag">&lt;<span class="name">user</span>&gt;</span>:<span class="tag">&lt;<span class="name">group</span>&gt;</span>] <span class="tag">&lt;<span class="name">src</span>&gt;</span>... <span class="tag">&lt;<span class="name">dest</span>&gt;</span></div><div class="line">ADD [--chown=<span class="tag">&lt;<span class="name">user</span>&gt;</span>:<span class="tag">&lt;<span class="name">group</span>&gt;</span>] ["<span class="tag">&lt;<span class="name">src</span>&gt;</span>",... "<span class="tag">&lt;<span class="name">dest</span>&gt;</span>"]</div></pre></td></tr></table></figure><p>关于该指令的详细说明，请参看<a href="https://docs.docker.com/engine/reference/builder/#add" target="_blank" rel="external">官方文旦</a></p><h3 id="COPY"><a href="#COPY" class="headerlink" title="COPY"></a>COPY</h3><blockquote><p>该指令和<code>ADD</code>指令类似。区别是<code>ADD</code>支持<code>src</code>是一个<code>URL</code>，而<code>COPY</code>不支持。</p></blockquote><h3 id="ENTRYPOINT"><a href="#ENTRYPOINT" class="headerlink" title="ENTRYPOINT"></a>ENTRYPOINT</h3><blockquote><p>2 种使用形式：shell 形式和 exec 形式</p></blockquote><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> [<span class="string">"executable"</span>, <span class="string">"param1"</span>, <span class="string">"param2"</span>] (<span class="built_in">exec</span> form, preferred)</span></div><div class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> <span class="built_in">command</span> param1 param2</span></div></pre></td></tr></table></figure><h3 id="VOLUME"><a href="#VOLUME" class="headerlink" title="VOLUME"></a>VOLUME</h3><blockquote><p>用指定的名称创建一个挂载点。使用形式：</p></blockquote><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">VOLUME</span><span class="bash"> [<span class="string">"/var/log/"</span>]</span></div><div class="line"><span class="keyword">VOLUME</span><span class="bash"> /var/<span class="built_in">log</span> /var/db</span></div></pre></td></tr></table></figure><h3 id="USER"><a href="#USER" class="headerlink" title="USER"></a>USER</h3><blockquote><p>设置 docker 镜像跑在哪个用户或者用户 ID 下，也可以设置一个可选的组或者组 ID 下。<br>如果没有设置组，默认使用<code>root</code>组。<br>其他的指令<code>RUN, CMD, ENTRYPOINT</code>也遵守这一规则。</p></blockquote><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">USER</span> <span class="title">&lt;user</span>&gt;[:<span class="tag">&lt;group&gt;</span>]</div><div class="line"><span class="keyword">USER</span> <span class="title">&lt;UID</span>&gt;[:<span class="tag">&lt;GID&gt;</span>]</div></pre></td></tr></table></figure><h3 id="WORKDIR"><a href="#WORKDIR" class="headerlink" title="WORKDIR"></a>WORKDIR</h3><blockquote><p>为<code>Dockerfile</code>中的<code>RUN, CMD, ENTRYPOINT, ADD, COPY</code>指令提供工作目录。<br><code>WORKDIR</code>可以在<code>Dockerfile</code>中出现多次，那么后面的路径时相对于前面的。</p></blockquote><p>TODO: 类似于 nodejs 中的 resolve 方法？解析到一个绝对路径为止？</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">WORKDIR</span><span class="bash"> /a</span></div><div class="line"><span class="keyword">WORKDIR</span><span class="bash"> b</span></div><div class="line"><span class="keyword">WORKDIR</span><span class="bash"> c</span></div><div class="line"><span class="keyword">RUN</span><span class="bash"> <span class="built_in">pwd</span></span></div><div class="line">=&gt; /a/b/c</div></pre></td></tr></table></figure><blockquote><p><code>WORKDIR</code>可以使用<code>Dockerfile</code>中已经定义的环境变量。</p></blockquote><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">ENV</span> DIRPATH /path</div><div class="line"><span class="keyword">WORKDIR</span><span class="bash"> <span class="variable">$DIRPATH</span>/<span class="variable">$DIRNAME</span></span></div><div class="line"><span class="keyword">RUN</span><span class="bash"> <span class="built_in">pwd</span></span></div><div class="line">=&gt; /path/$DIRNAME</div></pre></td></tr></table></figure><h2 id="compose文件结构"><a href="#compose文件结构" class="headerlink" title="compose文件结构"></a><code>compose</code>文件结构</h2><figure class="highlight yml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div></pre></td><td class="code"><pre><div class="line"><span class="attr">services:</span></div><div class="line"><span class="attr">    webapp:</span></div><div class="line">        <span class="comment"># 引用顶层的networks</span></div><div class="line"><span class="attr">        networks:</span></div><div class="line"><span class="bullet">            -</span> <span class="string">some-network</span></div><div class="line"><span class="bullet">            -</span> <span class="string">other-network</span></div><div class="line"><span class="attr">        depends_on:</span></div><div class="line"><span class="bullet">          -</span> <span class="string">db</span></div><div class="line"><span class="bullet">          -</span> <span class="string">redis</span></div><div class="line"><span class="attr">        build:</span></div><div class="line">            <span class="comment"># 包含Dockerfile的目录或者一个git仓库</span></div><div class="line">            <span class="comment"># 如果是一个相对路径，那么是相对于compose file文件的路径</span></div><div class="line"><span class="attr">            context:</span> <span class="string">'./dir'</span></div><div class="line"><span class="attr">            dockerfile:</span> <span class="string">Dockerfile-alternate</span></div><div class="line">            <span class="comment"># 既可以是一个对象，也可以是一个数组</span></div><div class="line">            <span class="comment"># 该选项指定在Dockerfile ARG选项中定义的参数</span></div><div class="line">            <span class="comment"># 第一种使用形式</span></div><div class="line"><span class="attr">            args:</span></div><div class="line"><span class="bullet">                -</span> <span class="string">buildno=1</span></div><div class="line"><span class="bullet">                -</span> <span class="string">password=secret</span></div><div class="line">            <span class="comment"># 第二种使用形式</span></div><div class="line"><span class="attr">            args:</span></div><div class="line"><span class="attr">                buildno:</span> <span class="number">1</span></div><div class="line">            <span class="comment"># 一个镜像列表指定docker引擎使用的缓存</span></div><div class="line"><span class="attr">            cache_form:</span></div><div class="line"><span class="attr">                - alpine:</span><span class="string">latest</span></div><div class="line"><span class="bullet">                -</span> <span class="string">corp/web_app:3.14</span></div><div class="line">            <span class="comment"># 添加元数据到结果镜像中</span></div><div class="line">            <span class="comment"># 第一种使用形式</span></div><div class="line"><span class="attr">            labels:</span></div><div class="line">                <span class="comment"># 推荐使用reverse-DNS命名规则，避免和其他软件使用的标签冲突</span></div><div class="line">                <span class="string">com.example.description:</span> <span class="string">"Accounting webapp"</span></div><div class="line">                <span class="string">com.example.department:</span> <span class="string">"Finance"</span></div><div class="line">                <span class="string">com.example.label-with-empty-value:</span> <span class="string">""</span></div><div class="line">            <span class="comment"># 第二种使用形式</span></div><div class="line"><span class="attr">            labels:</span></div><div class="line"><span class="bullet">                -</span> <span class="string">"com.example.description=Accounting webapp"</span></div><div class="line"><span class="bullet">                -</span> <span class="string">"com.example.department=Finance"</span></div><div class="line"><span class="bullet">                -</span> <span class="string">"com.example.label-with-empty-value"</span></div><div class="line">            <span class="comment"># 为构建的容器设置/dev/shm设置大小</span></div><div class="line"><span class="attr">            shm_size:</span></div><div class="line"><span class="attr">                shm_size:</span> <span class="string">'2gb'</span></div><div class="line">                <span class="comment"># 第二种使用形式，单位为byte</span></div><div class="line"><span class="attr">                shm_size:</span> <span class="number">10000000</span></div><div class="line">            <span class="comment"># 构建在Dockerfile中指定的时期</span></div><div class="line"><span class="attr">            target:</span> <span class="string">prod</span></div><div class="line">        <span class="comment"># 为服务指定部署和运行时的相关配置</span></div><div class="line"><span class="attr">        deploy:</span></div><div class="line"><span class="attr">            update_config:</span></div><div class="line">                <span class="comment"># 同一时间更新容器的数量</span></div><div class="line"><span class="attr">                parallelism:</span> <span class="number">2</span></div><div class="line"><span class="attr">                delay:</span> <span class="number">10</span><span class="string">s</span></div><div class="line">                <span class="comment"># 默认值stop-first，start-first</span></div><div class="line"><span class="attr">                order:</span> <span class="string">stop-first</span></div><div class="line">                <span class="comment"># 当一个更新失败的时候后续的动作</span></div><div class="line">                <span class="comment"># 默认值pause, continue, rollback</span></div><div class="line"><span class="attr">                failure_action:</span> <span class="string">continue</span></div><div class="line">                <span class="comment"># 配置在一个更新期间所能容忍的失败率</span></div><div class="line"><span class="attr">                max_failure_ratio:</span> <span class="string">'0.20'</span></div><div class="line">            <span class="comment"># 重启策略</span></div><div class="line"><span class="attr">            restart_policy:</span></div><div class="line">                <span class="comment"># any(默认值), none, on-failure</span></div><div class="line"><span class="attr">                condition:</span> <span class="string">on-failure</span></div><div class="line">                <span class="comment"># 重启时间间隔, 默认值0</span></div><div class="line"><span class="attr">                delay:</span> <span class="number">5</span><span class="string">s</span></div><div class="line"><span class="attr">                max_attempts:</span> <span class="number">3</span></div><div class="line"><span class="attr">                window:</span> <span class="number">120</span><span class="string">s</span></div><div class="line">            <span class="comment"># 只为这个服务设定标签</span></div><div class="line"><span class="attr">            labels:</span></div><div class="line">                <span class="string">com.example.description:</span> <span class="string">"This label will appear on the web service"</span></div><div class="line">            <span class="comment"># 默认值replicated</span></div><div class="line"><span class="attr">            mode:</span> <span class="string">global</span></div><div class="line">            <span class="comment"># 如果mode被设置为replicated,那么可以通过replicas来指定容器复制数量</span></div><div class="line"><span class="attr">            replicas:</span> <span class="number">6</span></div><div class="line"><span class="attr">            placement:</span></div><div class="line"><span class="attr">                constraints:</span></div><div class="line"><span class="bullet">                  -</span> <span class="string">node.role</span> <span class="string">==</span> <span class="string">manager</span></div><div class="line"><span class="bullet">                  -</span> <span class="string">engine.labels.operatingsystem</span> <span class="string">==</span> <span class="string">ubuntu</span> <span class="number">14.04</span></div><div class="line"><span class="attr">                preferences:</span></div><div class="line"><span class="attr">                  - spread:</span> <span class="string">node.labels.zone</span></div><div class="line">            <span class="comment"># 配置资源约束</span></div><div class="line"><span class="attr">            resources:</span></div><div class="line"><span class="attr">                limits:</span></div><div class="line"><span class="attr">                  cpus:</span> <span class="string">'0.50'</span></div><div class="line"><span class="attr">                  memory:</span> <span class="number">50</span><span class="string">M</span></div><div class="line"><span class="attr">                reservations:</span></div><div class="line"><span class="attr">                  cpus:</span> <span class="string">'0.25'</span></div><div class="line"><span class="attr">                  memory:</span> <span class="number">20</span><span class="string">M</span></div><div class="line"><span class="comment"># 增加或者移除容器的能力</span></div><div class="line"><span class="attr">cap_add:</span></div><div class="line"><span class="bullet">    -</span> <span class="string">ALL</span></div><div class="line"><span class="attr">cap_drop:</span></div><div class="line"><span class="bullet">  -</span> <span class="string">NET_ADMIN</span></div><div class="line"><span class="bullet">  -</span> <span class="string">SYS_ADMIN</span></div><div class="line"><span class="comment"># 重写默认的命令</span></div><div class="line"><span class="attr">command:</span> <span class="string">bundle</span> <span class="string">exec</span> <span class="string">thin</span> <span class="bullet">-p</span> <span class="number">3000</span></div><div class="line"><span class="attr">configs:</span></div><div class="line"><span class="comment"># 为容器指定一个父组</span></div><div class="line"><span class="attr">cgroup_parent:</span> <span class="string">m-executor-abcd</span></div><div class="line"><span class="comment"># 为容器指定自定义名称，docker容器名称必须唯一</span></div><div class="line"><span class="attr">container_name:</span> <span class="string">my-web-container</span></div><div class="line"><span class="comment"># 定义设备映射</span></div><div class="line"><span class="attr">devices:</span></div><div class="line"><span class="bullet">  -</span> <span class="string">"/dev/ttyUSB0:/dev/ttyUSB0"</span></div><div class="line"><span class="comment"># 自定义dns服务</span></div><div class="line"><span class="attr">dns:</span></div><div class="line"><span class="bullet">-</span> <span class="number">8.8</span><span class="number">.8</span><span class="number">.8</span></div><div class="line"><span class="bullet">-</span> <span class="number">9.9</span><span class="number">.9</span><span class="number">.9</span></div><div class="line"><span class="comment"># 可以是单个值</span></div><div class="line"><span class="attr">dns:</span> <span class="number">8.8</span><span class="number">.8</span><span class="number">.8</span></div><div class="line"><span class="comment"># 自定义dns搜索域</span></div><div class="line"><span class="attr">dns_search:</span> <span class="string">example.com</span></div><div class="line"><span class="attr">dns_search:</span></div><div class="line"><span class="bullet">  -</span> <span class="string">dc1.example.com</span></div><div class="line"><span class="bullet">  -</span> <span class="string">dc2.example.com</span></div><div class="line"><span class="comment"># 在容器内部临时挂载一个文件系统</span></div><div class="line"><span class="attr">tmpfs:</span> <span class="string">/run</span></div><div class="line"><span class="attr">tmpfs:</span></div><div class="line"><span class="bullet">-</span> <span class="string">/run</span></div><div class="line"><span class="bullet">-</span> <span class="string">/tmp</span></div><div class="line"><span class="comment"># 重写默认的entrypoint</span></div><div class="line"><span class="attr">entrypoint:</span></div><div class="line"><span class="bullet">    -</span> <span class="string">php</span></div><div class="line"><span class="bullet">    -</span> <span class="bullet">-d</span></div><div class="line"><span class="bullet">    -</span> <span class="string">zend_extension=/usr/local/lib/php/extensions/no-debug-non-zts-20100525/xdebug.so</span></div><div class="line"><span class="bullet">    -</span> <span class="bullet">-d</span></div><div class="line"><span class="bullet">    -</span> <span class="string">memory_limit=-1</span></div><div class="line"><span class="bullet">    -</span> <span class="string">vendor/bin/phpunit</span></div><div class="line"><span class="comment"># 增加环境变量来自一个文件</span></div><div class="line"><span class="attr">env_file:</span> <span class="string">.env</span></div><div class="line"><span class="attr">env_file:</span></div><div class="line"><span class="bullet">  -</span> <span class="string">./common.env</span></div><div class="line"><span class="bullet">  -</span> <span class="string">./apps/web.env</span></div><div class="line"><span class="bullet">  -</span> <span class="string">/opt/secrets.env</span></div><div class="line"><span class="string">networks</span></div><div class="line"><span class="string">volumes</span></div></pre></td></tr></table></figure><h2 id="网络（network）"><a href="#网络（network）" class="headerlink" title="网络（network）"></a>网络（network）</h2><h3 id="桥接网络（bridge-networks）"><a href="#桥接网络（bridge-networks）" class="headerlink" title="桥接网络（bridge networks）"></a>桥接网络（bridge networks）</h3><blockquote><p>一个桥接可以是一个硬件设备或者是运行在一个主机内核中的软件。</p></blockquote><p>用户自定义桥接网路的好处：</p><ol><li>提供更好的隔离和互通性。</li><li>在容器间提供自动化<code>DNS</code>解析。</li><li>随时绑定或者解绑一个容器到自定义网络。</li><li>每个用户自定义网络可以创建一个可配置的网络。</li></ol><p>创建用户自定义的网络：</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ docker network create <span class="keyword">my</span>-net</div></pre></td></tr></table></figure><p>移除一个自定义网络：</p><figure class="highlight stata"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ docker network <span class="keyword">rm</span> my-<span class="keyword">net</span></div></pre></td></tr></table></figure><p>如果一个容器当前正在使用这个网络，那么必须选断开：</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ docker network disconnect <span class="keyword">my</span>-net <span class="keyword">my</span>-nginx</div></pre></td></tr></table></figure><h2 id="宗卷（Volumes）"><a href="#宗卷（Volumes）" class="headerlink" title="宗卷（Volumes）"></a>宗卷（Volumes）</h2><blockquote><p>docker 中挂载数据的 3 种方式：</p></blockquote><ul><li>bind mount：利用机器的文件系统。</li><li>volumes：在文件系统中开辟一块区域来持久化数据，专门由 docker 管理。</li><li>tmpfs： 在内存中挂载数据，并不能持久化，当容器停止，数据丢失。</li></ul><p>关于以上 3 种的数据挂载方式，具体的介绍查<a href="https://docs.docker.com/storage/#choose-the-right-type-of-mount" target="_blank" rel="external">看官方文档</a></p><p>最推荐的方式是使用 Volumes（实际还是视具体情况而定），此处只讲 Volumes。</p><p>创建 Volumes:</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ docker <span class="keyword">volume</span><span class="bash"> create my-vol</span></div></pre></td></tr></table></figure><p>列出所有的 Volumes:</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ docker <span class="keyword">volume</span><span class="bash"> ls</span></div></pre></td></tr></table></figure><h2 id="发布镜像"><a href="#发布镜像" class="headerlink" title="发布镜像"></a>发布镜像</h2><ol><li><a href="https://cloud.docker.com/" target="_blank" rel="external">创建 docker 仓库</a></li></ol><blockquote><p>在<code>docker cloud</code>上只能免费创建一个私有仓库，无限制多个公有仓库。</p></blockquote><ol><li>创建镜像</li></ol><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ docker build -t username/<span class="keyword">tag</span> <span class="title">.</span></div></pre></td></tr></table></figure><ol><li>登录</li></ol><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">docker login</span></div></pre></td></tr></table></figure><ol><li>推送镜像</li></ol><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ docker <span class="keyword">push</span></div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;docker-简介&quot;&gt;&lt;a href=&quot;#docker-简介&quot; class=&quot;headerlink&quot; title=&quot;docker 简介&quot;&gt;&lt;/a&gt;docker 简介&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;docker 是一个开发，运输，运行程序的一个平台。doc
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>DOM元素的坐标，大小相关API梳理</title>
    <link href="https://xxxxxmiss.github.io/2018/01/07/element-coordinate/"/>
    <id>https://xxxxxmiss.github.io/2018/01/07/element-coordinate/</id>
    <published>2018-01-07T14:47:43.000Z</published>
    <updated>2018-01-07T17:34:41.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="getBoundingClientRect"><a href="#getBoundingClientRect" class="headerlink" title="getBoundingClientRect()"></a>getBoundingClientRect()</h2><blockquote><p>该API返回元素的大小及其相对于视口的位置。<br>需要注意的是：不论该元素是普通的元素，还是相对定位、绝对定位，还是fixed定位，亦或被定位（相对，绝对，fixed）元素包裹的元素，返回的对象中坐标(x,y)，top,left都是相对于视口的坐标。<br>如果该元素是可以滚动或者滑动的，那么坐标会立即改变的。<br>如果需要得到文档坐标，可以<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Element/getBoundingClientRect" target="_blank" rel="external">参看这里</a></p></blockquote><p>Note: 该API返回的对象包含如下几个属性，并且这些属性的值可以包含浮点数：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&#123;   <span class="attr">top</span>: <span class="string">''</span>,</div><div class="line">    <span class="attr">right</span>: <span class="string">''</span>,</div><div class="line">    <span class="attr">bottom</span>: <span class="string">''</span></div><div class="line">    left: <span class="string">''</span>,</div><div class="line">    <span class="attr">width</span>: <span class="string">''</span>, <span class="comment">// 该width是content+padding+border的宽度</span></div><div class="line">    height: <span class="string">''</span>,</div><div class="line">    <span class="attr">x</span>: <span class="string">''</span>,</div><div class="line">    <span class="attr">y</span>: <span class="string">''</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p><hr><p>以下的这些API返回的都是整数的像素值，不带单位的</p><h2 id="clientWidth"><a href="#clientWidth" class="headerlink" title="clientWidth"></a>clientWidth</h2><blockquote><p>只读属性，返回一个<code>block</code>或者<code>inline-block</code>元素的<code>content + padding</code>的像素值。<br>如果有滚动条存在，那么<code>clientWidth = content + padding - 垂直滚动条的宽度</code></p></blockquote><h2 id="clientLeft"><a href="#clientLeft" class="headerlink" title="clientLeft"></a>clientLeft</h2><blockquote><p>只读属性，返回一个<code>block</code>或者<code>inline-block</code>元素的边框的宽度（border-width）的像素值。<br>如果有滚动条存在，那么该宽度是包含滚动条在内的宽度。</p></blockquote><h2 id="scrollHeight"><a href="#scrollHeight" class="headerlink" title="scrollHeight"></a>scrollHeight</h2><blockquote><p>只读属性，包括元素的整个高度（溢出导致在视野之外的部分）<br>这个整个高度也是<code>content + padding</code>的高度，不包括<code>border</code>和<code>margin</code>的高度。</p></blockquote><h2 id="scrollTop"><a href="#scrollTop" class="headerlink" title="scrollTop"></a>scrollTop</h2><blockquote><p>读取或者设置垂直滚动条的高度</p></blockquote><h2 id="offsetHeight"><a href="#offsetHeight" class="headerlink" title="offsetHeight"></a>offsetHeight</h2><blockquote><p>该属性返回一个元素的<code>content + padding + border + 滚动条（如果有）</code>的高度，不论该元素是<code>inline</code>还是<code>block</code>类型的元素。</p></blockquote><h2 id="offsetLeft"><a href="#offsetLeft" class="headerlink" title="offsetLeft"></a>offsetLeft</h2><blockquote><p>只读属性，返回当前元素左上角相对于<code>offsetParent</code>节点的左边界偏移的像素值。<br>详细信息可<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/HTMLElement/offsetLeft" target="_blank" rel="external">参看这里</a></p></blockquote><h2 id="offsetParent"><a href="#offsetParent" class="headerlink" title="offsetParent"></a>offsetParent</h2><blockquote><p>只读属性，返回一个<strong>最近的</strong>的包含该元素的定位元素。如果没有定位元素，那么<code>offsetParent</code>为<strong>最近的</strong><code>table</code>,<code>table cell</code>或者根元素<code>html</code>。</p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;getBoundingClientRect&quot;&gt;&lt;a href=&quot;#getBoundingClientRect&quot; class=&quot;headerlink&quot; title=&quot;getBoundingClientRect()&quot;&gt;&lt;/a&gt;getBoundingClientRect
      
    
    </summary>
    
      <category term="js" scheme="https://xxxxxmiss.github.io/categories/js/"/>
    
    
      <category term="dom" scheme="https://xxxxxmiss.github.io/tags/dom/"/>
    
  </entry>
  
  <entry>
    <title>parclejs</title>
    <link href="https://xxxxxmiss.github.io/2017/12/12/parclejs/"/>
    <id>https://xxxxxmiss.github.io/2017/12/12/parclejs/</id>
    <published>2017-12-11T16:36:15.000Z</published>
    <updated>2017-12-11T17:17:05.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="核心依赖库"><a href="#核心依赖库" class="headerlink" title="核心依赖库"></a>核心依赖库</h2><ul><li><a href="https://github.com/babel/babel/tree/master/packages/babylon" target="_blank" rel="external">babylon</a></li><li><a href="https://github.com/defunctzombie/node-browser-resolve" target="_blank" rel="external">browser-resolve</a></li><li><a href="https://github.com/webpack/node-libs-browser" target="_blank" rel="external">node-libs-browser</a></li><li><a href="https://github.com/pugjs/babylon-walk" target="_blank" rel="external">babylon-walk</a></li><li><a href="https://github.com/thejameskyle/babel-types" target="_blank" rel="external">babel-types</a></li><li><a href="https://github.com/rvagg/node-worker-farm" target="_blank" rel="external">worker-farm</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;核心依赖库&quot;&gt;&lt;a href=&quot;#核心依赖库&quot; class=&quot;headerlink&quot; title=&quot;核心依赖库&quot;&gt;&lt;/a&gt;核心依赖库&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/babel/babel/tree/master/
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>vue-ssr</title>
    <link href="https://xxxxxmiss.github.io/2017/12/04/vue-ssr/"/>
    <id>https://xxxxxmiss.github.io/2017/12/04/vue-ssr/</id>
    <published>2017-12-04T07:20:00.000Z</published>
    <updated>2017-12-25T03:57:05.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="整合jsx"><a href="#整合jsx" class="headerlink" title="整合jsx"></a>整合jsx</h2><h3 id="依赖包"><a href="#依赖包" class="headerlink" title="依赖包"></a>依赖包</h3><ul><li>babel-plugin-syntax-jsx</li><li>babel-plugin-transform-runtime</li><li>babel-plugin-transform-vue-jsx</li></ul><h3 id="nuxt-config-js"><a href="#nuxt-config-js" class="headerlink" title="nuxt.config.js"></a>nuxt.config.js</h3><blockquote><p>在<code>build</code>配置项中增加如下配置</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">build: &#123;</div><div class="line">    <span class="attr">babel</span>: &#123;</div><div class="line">      <span class="string">"presets"</span>: [</div><div class="line">        [<span class="string">"env"</span>, &#123;</div><div class="line">          <span class="string">"modules"</span>: <span class="literal">false</span></div><div class="line">        &#125;],</div><div class="line">        <span class="string">"stage-2"</span>, <span class="comment">// 为了使用对象的延展语法</span></div><div class="line">        <span class="string">"flow"</span></div><div class="line">      ],</div><div class="line">      <span class="string">"plugins"</span>: [<span class="string">"transform-runtime"</span>, <span class="string">"transform-vue-jsx"</span>]</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><h3 id="如果只是使用客户端渲染，在-eslintrc中配置"><a href="#如果只是使用客户端渲染，在-eslintrc中配置" class="headerlink" title="如果只是使用客户端渲染，在.eslintrc中配置"></a>如果只是使用客户端渲染，在.eslintrc中配置</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"presets"</span>: [</div><div class="line">    [<span class="string">"env"</span>, &#123;</div><div class="line">      <span class="attr">"modules"</span>: <span class="literal">false</span></div><div class="line">    &#125;],</div><div class="line">    <span class="string">"stage-2"</span>, // 为了使用对象的延展语法</div><div class="line">    <span class="string">"flow"</span></div><div class="line">  ],</div><div class="line">  <span class="attr">"plugins"</span>: [<span class="string">"transform-runtime"</span>, <span class="string">"transform-vue-jsx"</span>]  </div><div class="line">&#125;</div></pre></td></tr></table></figure><h2 id="整合flow"><a href="#整合flow" class="headerlink" title="整合flow"></a>整合flow</h2><h3 id="依赖包-1"><a href="#依赖包-1" class="headerlink" title="依赖包"></a>依赖包</h3><ul><li>babel-preset-flow</li><li>eslint-plugin-flowtype</li></ul><h3 id="eslintrc-js配置"><a href="#eslintrc-js配置" class="headerlink" title=".eslintrc.js配置"></a>.eslintrc.js配置</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">plugins: [</div><div class="line">  <span class="string">'html'</span>,</div><div class="line">  <span class="string">'flowtype'</span></div><div class="line">],</div><div class="line"><span class="string">'extends'</span>: [</div><div class="line">    <span class="string">'standard'</span>,</div><div class="line">    <span class="string">'plugin:flowtype/recommended'</span></div><div class="line">]</div></pre></td></tr></table></figure><h3 id="flow配置文件"><a href="#flow配置文件" class="headerlink" title="flow配置文件"></a>flow配置文件</h3><blockquote><p>在项目的根目录下增加<code>.flowconfig</code>配置文件，具体配置也可以查看flow的官方文档。<br><a href="https://flow.org/en/docs/install/" target="_blank" rel="external">flow</a></p></blockquote><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="string">[ignore]</span></div><div class="line">.*/node_modules/.*</div><div class="line">.*/dist/.*</div><div class="line">.*/public</div><div class="line"></div><div class="line"><span class="string">[include]</span></div><div class="line"></div><div class="line"><span class="string">[libs]</span></div><div class="line">flow</div><div class="line"></div><div class="line"><span class="string">[options]</span></div><div class="line">unsafe.enable_getters_and_setters=true</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;整合jsx&quot;&gt;&lt;a href=&quot;#整合jsx&quot; class=&quot;headerlink&quot; title=&quot;整合jsx&quot;&gt;&lt;/a&gt;整合jsx&lt;/h2&gt;&lt;h3 id=&quot;依赖包&quot;&gt;&lt;a href=&quot;#依赖包&quot; class=&quot;headerlink&quot; title=&quot;依赖包&quot;&gt;&lt;/
      
    
    </summary>
    
      <category term="构建工具" scheme="https://xxxxxmiss.github.io/categories/%E6%9E%84%E5%BB%BA%E5%B7%A5%E5%85%B7/"/>
    
    
      <category term="vue" scheme="https://xxxxxmiss.github.io/tags/vue/"/>
    
      <category term="ssr" scheme="https://xxxxxmiss.github.io/tags/ssr/"/>
    
  </entry>
  
  <entry>
    <title>yueta</title>
    <link href="https://xxxxxmiss.github.io/2017/11/29/yueta/"/>
    <id>https://xxxxxmiss.github.io/2017/11/29/yueta/</id>
    <published>2017-11-29T03:37:17.000Z</published>
    <updated>2017-11-30T07:01:44.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="登录"><a href="#登录" class="headerlink" title="登录"></a>登录</h1><figure class="highlight stata"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">post</span> /signin</div><div class="line">name</div><div class="line"><span class="keyword">pwd</span></div><div class="line">captcha</div></pre></td></tr></table></figure><h1 id="退出"><a href="#退出" class="headerlink" title="退出"></a>退出</h1><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">post</span> /signout</div></pre></td></tr></table></figure><h1 id="意见反馈"><a href="#意见反馈" class="headerlink" title="意见反馈"></a>意见反馈</h1><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">get</span> /feedbacks</div><div class="line"><span class="comment">// 分页参数</span></div><div class="line">pagesize</div><div class="line">page</div><div class="line"><span class="comment">// 筛选参数</span></div><div class="line">company_email</div><div class="line">start_time</div><div class="line">end_time</div></pre></td></tr></table></figure><h1 id="顾问-consultants-相关"><a href="#顾问-consultants-相关" class="headerlink" title="顾问(consultants)相关"></a>顾问(consultants)相关</h1><h2 id="排行版"><a href="#排行版" class="headerlink" title="排行版"></a>排行版</h2><figure class="highlight maxima"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">get</span> /consultants/<span class="built_in">rank</span></div></pre></td></tr></table></figure><h2 id="添加顾问"><a href="#添加顾问" class="headerlink" title="添加顾问"></a>添加顾问</h2><figure class="highlight dts"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">post <span class="meta-keyword">/consultants/</span>add</div><div class="line"><span class="comment">// 组id</span></div><div class="line">group_id <span class="comment">// 0（第一组）1（第一组）...以此类推</span></div><div class="line">name</div><div class="line">email</div><div class="line"><span class="symbol">is_leader:</span> <span class="number">0</span>（不是）<span class="number">1</span>（是） <span class="comment">// 是否为组长</span></div></pre></td></tr></table></figure><h2 id="标记顾问为离职"><a href="#标记顾问为离职" class="headerlink" title="标记顾问为离职"></a>标记顾问为离职</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">post <span class="regexp">/consultants/</span>leave</div><div class="line">consultant_id</div></pre></td></tr></table></figure><h2 id="获取跟进人列表"><a href="#获取跟进人列表" class="headerlink" title="获取跟进人列表"></a>获取跟进人列表</h2><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">get</span> /consultants</div></pre></td></tr></table></figure><h2 id="今日业绩汇总"><a href="#今日业绩汇总" class="headerlink" title="今日业绩汇总"></a>今日业绩汇总</h2><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">get</span> /consultants/statistics</div><div class="line"><span class="comment">// 筛选参数</span></div><div class="line">group_id <span class="comment">// 分组</span></div><div class="line">start_time <span class="comment">// 起始时间</span></div><div class="line">end_time <span class="comment">// 结束时间</span></div></pre></td></tr></table></figure><h1 id="客户-companies-相关"><a href="#客户-companies-相关" class="headerlink" title="客户(companies)相关"></a>客户(companies)相关</h1><h2 id="客户列表（支持分页，筛选查询）"><a href="#客户列表（支持分页，筛选查询）" class="headerlink" title="客户列表（支持分页，筛选查询）"></a>客户列表（支持分页，筛选查询）</h2><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">get</span> /companies</div><div class="line"><span class="comment">// 分页参数</span></div><div class="line">pagesize</div><div class="line">page</div><div class="line"><span class="comment">// 筛选参数</span></div><div class="line">company_email</div><div class="line"><span class="comment">// 管理员使用更多的参数</span></div><div class="line">consultant_id <span class="comment">// 当前更进人</span></div><div class="line">category_id <span class="comment">// 免费等</span></div><div class="line">allocated: <span class="number">0</span>（未分配）<span class="number">1</span>（已分配）</div></pre></td></tr></table></figure><h2 id="查看约Ta职位（查询该客户【公司，企业】下的所有职位列表-支持分页）"><a href="#查看约Ta职位（查询该客户【公司，企业】下的所有职位列表-支持分页）" class="headerlink" title="查看约Ta职位（查询该客户【公司，企业】下的所有职位列表,支持分页）"></a>查看约Ta职位（查询该客户【公司，企业】下的所有职位列表,支持分页）</h2><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">get</span> /positions</div><div class="line"><span class="comment">// 分页参数</span></div><div class="line">pagesize</div><div class="line">page</div><div class="line"><span class="comment">// 公司id</span></div><div class="line">company_id</div></pre></td></tr></table></figure><h2 id="简历列表-查看某一职位下的所有简历，支持分页"><a href="#简历列表-查看某一职位下的所有简历，支持分页" class="headerlink" title="简历列表(查看某一职位下的所有简历，支持分页)"></a>简历列表(查看某一职位下的所有简历，支持分页)</h2><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">get</span> /resumes</div><div class="line"><span class="comment">// 分页参数</span></div><div class="line">pagesize</div><div class="line">page</div><div class="line"></div><div class="line">company_id <span class="comment">// 公司id</span></div><div class="line">position_id <span class="comment">// 职位id</span></div></pre></td></tr></table></figure><h2 id="更新邮箱"><a href="#更新邮箱" class="headerlink" title="更新邮箱"></a>更新邮箱</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">post <span class="regexp">/resumes/u</span>pdate_email</div><div class="line"><span class="regexp">//</span> 简历id</div><div class="line">id </div><div class="line">email</div><div class="line">position_id <span class="regexp">//</span> 职位id</div></pre></td></tr></table></figure><h2 id="稍后联系"><a href="#稍后联系" class="headerlink" title="稍后联系"></a>稍后联系</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">post <span class="regexp">/resumes/</span>delay_contact</div><div class="line"><span class="regexp">//</span> 简历id</div><div class="line">id </div><div class="line"><span class="regexp">//</span> 备注</div><div class="line">remark</div></pre></td></tr></table></figure><h2 id="手机号码无效"><a href="#手机号码无效" class="headerlink" title="手机号码无效"></a>手机号码无效</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">post <span class="regexp">/resumes/</span>phone_invalid</div><div class="line"><span class="regexp">//</span> 简历id</div><div class="line">id</div><div class="line"><span class="regexp">//</span> 手机号</div><div class="line">phone</div></pre></td></tr></table></figure><h2 id="状态处理（获取已有状态数据）"><a href="#状态处理（获取已有状态数据）" class="headerlink" title="状态处理（获取已有状态数据）"></a>状态处理（获取已有状态数据）</h2><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">get</span> /resumes/get_status</div><div class="line"><span class="comment">// 简历id</span></div><div class="line">id</div></pre></td></tr></table></figure><h2 id="状态处理（更新状态）"><a href="#状态处理（更新状态）" class="headerlink" title="状态处理（更新状态）"></a>状态处理（更新状态）</h2><figure class="highlight haxe"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">post /resumes/update_status</div><div class="line">id <span class="comment">// 简历id</span></div><div class="line">name</div><div class="line">current_status</div><div class="line">phone</div><div class="line">expect_salary_start</div><div class="line">expect_salary_end</div><div class="line">expect_work_place</div><div class="line">in_place <span class="comment">// 所在地</span></div><div class="line">current_msalary_start <span class="comment">// 当前月薪</span></div><div class="line">current_msalary_end</div><div class="line">current_ysalary_start <span class="comment">// 当前年薪</span></div><div class="line">current_ysalary_end</div><div class="line"></div><div class="line">resume_time_start <span class="comment">// 简历最新工作时间</span></div><div class="line">resume_time_end</div><div class="line">resume_company</div><div class="line">resume_position</div><div class="line"><span class="keyword">new</span><span class="type">_time_start</span> <span class="comment">// 最新工作时间</span></div><div class="line"><span class="keyword">new</span><span class="type">_time_end</span></div><div class="line"><span class="keyword">new</span><span class="type">_company</span> <span class="comment">// 最新公司</span></div><div class="line"><span class="keyword">new</span><span class="type">_position</span></div><div class="line"></div><div class="line">intention</div><div class="line">    call_time</div><div class="line">    working_date</div><div class="line">    resume_remark</div><div class="line">    common_tag</div><div class="line">    yueta_remark</div><div class="line">    msgtify</div><div class="line">other</div><div class="line">    reasonnintention</div><div class="line">    remark</div><div class="line">none</div><div class="line">    reasonnintention</div><div class="line">    remark</div></pre></td></tr></table></figure><h2 id="更换跟进人"><a href="#更换跟进人" class="headerlink" title="更换跟进人"></a>更换跟进人</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">post <span class="regexp">/companies/</span>change_consultant</div><div class="line"><span class="regexp">//</span> 一些待确定参数</div><div class="line">consultant_id <span class="regexp">//</span> 更进人id</div></pre></td></tr></table></figure><h2 id="获取待分配公司列表-已废弃"><a href="#获取待分配公司列表-已废弃" class="headerlink" title="获取待分配公司列表(已废弃)"></a>获取待分配公司列表(已废弃)</h2><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">get</span> /companies/will_allocate</div><div class="line"><span class="comment">// 支持筛选</span></div><div class="line">email</div><div class="line">category_id <span class="comment">// 0（免费）1（体验）2（付费）</span></div><div class="line">filter_one <span class="comment">// true, false</span></div></pre></td></tr></table></figure><h2 id="分配公司"><a href="#分配公司" class="headerlink" title="分配公司"></a>分配公司</h2><figure class="highlight dts"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">post <span class="meta-keyword">/companies/</span>allocate</div><div class="line"><span class="symbol">company_ids:</span> [] <span class="comment">// 客户id</span></div><div class="line">group_id <span class="comment">// 组</span></div><div class="line">consultant_id <span class="comment">// 更进人id</span></div></pre></td></tr></table></figure><h2 id="公司分配之报表查询（待确定）"><a href="#公司分配之报表查询（待确定）" class="headerlink" title="公司分配之报表查询（待确定）"></a>公司分配之报表查询（待确定）</h2><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">get</span> /companies/reports</div><div class="line">company_email</div><div class="line">start_time</div><div class="line">end_time</div></pre></td></tr></table></figure><h1 id="记录-record-相关"><a href="#记录-record-相关" class="headerlink" title="记录(record)相关"></a>记录(record)相关</h1><blockquote><p>考虑划分到简历下</p></blockquote><h2 id="历史记录（支持分页，筛选查询）"><a href="#历史记录（支持分页，筛选查询）" class="headerlink" title="历史记录（支持分页，筛选查询）"></a>历史记录（支持分页，筛选查询）</h2><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">get</span> /record/history</div><div class="line"><span class="comment">// 分页参数</span></div><div class="line">pagesize</div><div class="line">page</div><div class="line"><span class="comment">// 筛选参数</span></div><div class="line">company_email <span class="comment">// 公司邮箱</span></div><div class="line">resume_id <span class="comment">// 简历id</span></div><div class="line"><span class="comment">// 愿意沟通（0） 手机号码无效（1） 结束联系（2） 不看机会（3） 看其他机会（4）</span></div><div class="line">category_id</div><div class="line"><span class="comment">// 管理员使用更多的参数</span></div><div class="line">operator_id <span class="comment">// 操作者id</span></div><div class="line">start_time</div><div class="line">end_time</div></pre></td></tr></table></figure><h2 id="管理员更改历史状态"><a href="#管理员更改历史状态" class="headerlink" title="管理员更改历史状态"></a>管理员更改历史状态</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">post <span class="regexp">/record/u</span>pdate_status</div><div class="line"><span class="regexp">//</span> 参数待确定</div></pre></td></tr></table></figure><h1 id="配置-config-相关"><a href="#配置-config-相关" class="headerlink" title="配置(config)相关"></a>配置(config)相关</h1><h2 id="省市的查询（看具体实现，也可能是静态数据）"><a href="#省市的查询（看具体实现，也可能是静态数据）" class="headerlink" title="省市的查询（看具体实现，也可能是静态数据）"></a>省市的查询（看具体实现，也可能是静态数据）</h2><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">get</span> /configs/city</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;登录&quot;&gt;&lt;a href=&quot;#登录&quot; class=&quot;headerlink&quot; title=&quot;登录&quot;&gt;&lt;/a&gt;登录&lt;/h1&gt;&lt;figure class=&quot;highlight stata&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div c
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>centos7部署nodejs+mongodb工程</title>
    <link href="https://xxxxxmiss.github.io/2017/10/14/nodejs-deploy/"/>
    <id>https://xxxxxmiss.github.io/2017/10/14/nodejs-deploy/</id>
    <published>2017-10-14T06:13:20.000Z</published>
    <updated>2018-03-05T07:31:08.675Z</updated>
    
    <content type="html"><![CDATA[<h2 id="通过ssh登录阿里云主机"><a href="#通过ssh登录阿里云主机" class="headerlink" title="通过ssh登录阿里云主机"></a>通过ssh登录阿里云主机</h2><blockquote><p>ssh username@公网ip</p></blockquote><figure class="highlight crystal"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">bin</div><div class="line">boot</div><div class="line">dev</div><div class="line">etc</div><div class="line">home</div><div class="line"><span class="class"><span class="keyword">lib</span></span></div><div class="line">lib64</div><div class="line">lost+found</div><div class="line">media</div><div class="line">mnt</div><div class="line">opt</div><div class="line">proc</div><div class="line">root    [使用ssh root@公网ip成功登录后进入的目录]</div><div class="line">run</div><div class="line">sbin</div><div class="line">srv</div><div class="line">sys</div><div class="line">tmp</div><div class="line">usr</div><div class="line">var</div></pre></td></tr></table></figure><p>当使用root用户登录以后，会进入root目录，当你切换到上一层目录后，会看到如上所示的目录结构。</p><h2 id="安装nvm"><a href="#安装nvm" class="headerlink" title="安装nvm"></a>安装nvm</h2><blockquote><p>通过上一步的登录阿里云主机之后，你可以直接在root目录下，也可以新建其他的目录，然后安装nvm。<br><code>nvm</code>是node版本管理工具，通过该工具可以很方便的管理Node版本。</p></blockquote><p>具体的安装步骤参考官方文档：<br><a href="https://github.com/creationix/nvm" target="_blank" rel="external">nvm</a></p><h2 id="安装nodejs"><a href="#安装nodejs" class="headerlink" title="安装nodejs"></a>安装nodejs</h2><blockquote><p>一旦<code>nvm</code>成功安装以后，我们就可以通过<code>nvm</code>来安装nodejs。比如：</p></blockquote><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">nvm install <span class="keyword">node</span> <span class="title">// 安装最新版的nodejs</span></div></pre></td></tr></table></figure><h2 id="安装mongodb"><a href="#安装mongodb" class="headerlink" title="安装mongodb"></a>安装mongodb</h2><blockquote><p>具体的安装细节可以参照<a href="https://docs.mongodb.com/manual/tutorial/install-mongodb-on-red-hat/" target="_blank" rel="external">mongodb官方文档</a>。</p></blockquote><p>注意： 下面以在<strong>64-bit systems</strong>安装最新版的<strong>mongdb3.4</strong>为例：</p><h3 id="配置包管理系统-yum"><a href="#配置包管理系统-yum" class="headerlink" title="配置包管理系统(yum)"></a>配置包管理系统(yum)</h3><blockquote><p>新建/etc/yum.repos.d/mongodb-org-3.4.repo文件，然后将以下代码拷贝到该文件中.</p></blockquote><figure class="highlight ini"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="section">[mongodb-org-3.4]</span></div><div class="line"><span class="attr">name</span>=MongoDB Repository</div><div class="line"><span class="attr">baseurl</span>=https://repo.mongodb.org/yum/redhat/<span class="variable">$releasever</span>/mongodb-org/<span class="number">3.4</span>/x<span class="number">86_64</span>/</div><div class="line"><span class="attr">gpgcheck</span>=<span class="number">1</span></div><div class="line"><span class="attr">enabled</span>=<span class="number">1</span></div><div class="line"><span class="attr">gpgkey</span>=https://www.mongodb.org/static/pgp/server-<span class="number">3.4</span>.asc</div></pre></td></tr></table></figure><h3 id="安装mongodb包和相关的工具"><a href="#安装mongodb包和相关的工具" class="headerlink" title="安装mongodb包和相关的工具"></a>安装mongodb包和相关的工具</h3><blockquote><p>sudo yum install -y mongodb-org</p></blockquote><p>默认情况下，mongodb存储数据在<code>/var/lib/mongo</code>，日志文件在<code>/var/log/mongodb</code>。当然，这些配置都是可以在<code>/etc/mongod.conf</code>中修改。</p><h3 id="启动mongodb"><a href="#启动mongodb" class="headerlink" title="启动mongodb"></a>启动mongodb</h3><blockquote><p>sudo service mongod start</p></blockquote><h3 id="查看mongodb是否成功启动"><a href="#查看mongodb是否成功启动" class="headerlink" title="查看mongodb是否成功启动"></a>查看mongodb是否成功启动</h3><blockquote><p>在日志文件中查看是否有这样的一行：[initandlisten] waiting for connections on port <port></port></p></blockquote><p>port：默认端口27017，可以在<code>/etc/mongod.conf</code>中修改。</p><h3 id="停止mongodb"><a href="#停止mongodb" class="headerlink" title="停止mongodb"></a>停止mongodb</h3><blockquote><p>sudo service mongod stop</p></blockquote><h3 id="重启mongodb"><a href="#重启mongodb" class="headerlink" title="重启mongodb"></a>重启mongodb</h3><blockquote><p>sudo service mongod restart</p></blockquote><h3 id="卸载mongodb"><a href="#卸载mongodb" class="headerlink" title="卸载mongodb"></a>卸载mongodb</h3><blockquote><p>卸载mongodb，会将mongodb程序本身，他的配置文件，以及所有的数据删除，并且该过程是不可逆的。所以在卸载之前，确保已经备份。</p></blockquote><h4 id="停止mongodb-1"><a href="#停止mongodb-1" class="headerlink" title="停止mongodb"></a>停止mongodb</h4><blockquote><p>sudo service mongod stop</p></blockquote><h4 id="移除包"><a href="#移除包" class="headerlink" title="移除包"></a>移除包</h4><blockquote><p>sudo yum erase $(rpm -qa | grep mongodb-org)</p></blockquote><h4 id="移除数据"><a href="#移除数据" class="headerlink" title="移除数据"></a>移除数据</h4><blockquote><p>sudo rm -r /var/log/mongodb<br>sudo rm -r /var/lib/mongo</p></blockquote><h2 id="安装nginx"><a href="#安装nginx" class="headerlink" title="安装nginx"></a>安装nginx</h2><blockquote><p>可以直接从官网下载压缩包，也可以通过源码构建。因为nginx还依赖一些其他的包来扩展功能，所以还需要安装一些其他的依赖包。具体选择安装哪些依赖包，看你需要什么功能。</p></blockquote><h3 id="安装nginx所需的几个依赖包"><a href="#安装nginx所需的几个依赖包" class="headerlink" title="安装nginx所需的几个依赖包"></a>安装nginx所需的几个依赖包</h3><blockquote><p>yum install gcc-c++ pcre pcre-devel zlib zlib-devel openssl openssl-devel</p></blockquote><h3 id="通过源码构建"><a href="#通过源码构建" class="headerlink" title="通过源码构建"></a>通过源码构建</h3><blockquote><p><a href="http://nginx.org/en/docs/configure.html" target="_blank" rel="external">build nginx from source</a></p></blockquote><h3 id="启动nginx"><a href="#启动nginx" class="headerlink" title="启动nginx"></a>启动nginx</h3><blockquote><p>service nginx start</p></blockquote><h3 id="重启nginx"><a href="#重启nginx" class="headerlink" title="重启nginx"></a>重启nginx</h3><blockquote><p>service nginx restart</p></blockquote><h2 id="安装git"><a href="#安装git" class="headerlink" title="安装git"></a>安装git</h2><blockquote><p>yum install git</p></blockquote><p>更多git信息<a href="https://git-scm.com/download/linux" target="_blank" rel="external">传送门</a></p><h2 id="安装pm2"><a href="#安装pm2" class="headerlink" title="安装pm2"></a>安装pm2</h2><blockquote><p>npm install pm2 -g</p></blockquote><p>更多pm2信息<a href="https://github.com/Unitech/pm2" target="_blank" rel="external">传送门</a></p><h2 id="开始部署项目"><a href="#开始部署项目" class="headerlink" title="开始部署项目"></a>开始部署项目</h2><blockquote><p>当上面的准备工作全部成功的完成以后，我们就可以部署我们的nodejs工程了。</p></blockquote><h3 id="克隆nodejs工程到阿里云主机"><a href="#克隆nodejs工程到阿里云主机" class="headerlink" title="克隆nodejs工程到阿里云主机"></a>克隆nodejs工程到阿里云主机</h3><blockquote><p>git clone …</p></blockquote><h3 id="安装工程依赖"><a href="#安装工程依赖" class="headerlink" title="安装工程依赖"></a>安装工程依赖</h3><blockquote><p>npm install</p></blockquote><h3 id="启动工程"><a href="#启动工程" class="headerlink" title="启动工程"></a>启动工程</h3><blockquote><p>pm2 start app.js</p></blockquote><h2 id="安装docker"><a href="#安装docker" class="headerlink" title="安装docker"></a>安装docker</h2><blockquote><p><a href="https://docs.docker.com/install/linux/docker-ce/centos/#install-using-the-repository" target="_blank" rel="external">centos7安装docker</a></p></blockquote><p>这里有一个需要注意的地方，就是按照官方文档安装<code>yum</code>工具包的时候，如果当前用户非<code>root</code>用户，那么使用<code>sudo</code>安装的时候，会出现<code>xxx 不在 sudoers 文件中</code>的错误提示。<br>我们可以按照如下步骤将<code>xxx</code>用户添加到<code>sudoers</code>列表中</p><ul><li>切换到<code>root</code>用户登录centos，查看<code>sudoers</code>文件</li></ul><figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"># ll /etc/sudoers</div><div class="line">-r-------- <span class="number">1</span> root root <span class="number">3907</span> <span class="number">6</span>月  <span class="number">23</span> <span class="number">2017</span> /etc/sudoers</div><div class="line">(上面这一行代表 /etc/sudoers 文件的权限是<span class="number">400</span>)</div></pre></td></tr></table></figure><ul><li>修改该文件的权限，让其可写：</li></ul><figure class="highlight vala"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta"># chmod 600 /etc/sudoers</span></div></pre></td></tr></table></figure><ul><li>将<code>xxx</code>用户添加至 <code>/etc/sudoers</code> 文件</li></ul><figure class="highlight ada"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">root <span class="keyword">ALL</span>=(<span class="keyword">ALL</span>) <span class="keyword">ALL</span> # 这行本来就有，你需要将下面的那行添加至改行的后面</div><div class="line"></div><div class="line">xxx <span class="keyword">ALL</span>=(<span class="keyword">ALL</span>) <span class="keyword">ALL</span></div></pre></td></tr></table></figure><ul><li>再将<code>/etc/sudoers</code> 权限改回去</li></ul><figure class="highlight vala"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta"># chmod 400 /etc/sudoers</span></div></pre></td></tr></table></figure><p>那么现在在切换到<code>xxx</code>用户登录centos,就可以成功的安装<code>yum</code>工具包了。</p><h2 id="配置linux主机-以便和docker更好的协作"><a href="#配置linux主机-以便和docker更好的协作" class="headerlink" title="配置linux主机,以便和docker更好的协作"></a>配置linux主机,以便和docker更好的协作</h2><blockquote><p><a href="https://docs.docker.com/install/linux/linux-postinstall/#manage-docker-as-a-non-root-user" target="_blank" rel="external">官方详细文档传送门</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;通过ssh登录阿里云主机&quot;&gt;&lt;a href=&quot;#通过ssh登录阿里云主机&quot; class=&quot;headerlink&quot; title=&quot;通过ssh登录阿里云主机&quot;&gt;&lt;/a&gt;通过ssh登录阿里云主机&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;ssh username@公网ip
      
    
    </summary>
    
    
      <category term="nodejs" scheme="https://xxxxxmiss.github.io/tags/nodejs/"/>
    
      <category term="mongodb" scheme="https://xxxxxmiss.github.io/tags/mongodb/"/>
    
  </entry>
  
  <entry>
    <title>css动画常见案例</title>
    <link href="https://xxxxxmiss.github.io/2017/10/10/css-transition-1/"/>
    <id>https://xxxxxmiss.github.io/2017/10/10/css-transition-1/</id>
    <published>2017-10-10T12:28:18.000Z</published>
    <updated>2017-10-14T13:42:27.000Z</updated>
    
    <content type="html"><![CDATA[<style type="text/css" media="screen">   .container{     margin: 15px auto;   }   .btn{     position: relative;     display: inline-block;     box-sizing: border-box;     outline: none;     border: 1px solid #ebebeb;     padding: 0 15px;     height: 30px;     line-height: 30px;     border-radius: 4px;     user-select: none;     cursor: pointer;     text-align: center;     color: #fff;     background-color: #00c1de;   }   .btn.btn-blink:after{     position: absolute;     content: "";     top: -1px;     left: -1px;     bottom: -1px;     right: -1px;     border: 0 solid #00c1de;     border-radius: 4px;     box-shadow: 0 0 2px 0 #00c1de;     animation: blink .3s cubic-bezier(.645,.045,.355,1);   }   @keyframes blink{     from {       opacity: 1;       transform: scale(1);     }     to {       opacity: 0;       transform: scale3d(1.1, 1.2, 0);     }   }   .btn-round-blink{     font-size: 30px;     font-weight: 500;     margin: 0 30px;     height: 30px;     width: 30px;     border-radius: 50%;   }   .btn-round-blink:before,   .btn-round-blink:after{     position: absolute;     content: "";     top: 0;     left: 0;     right: 0;     bottom: 0;     border: 1px solid #00c1de;     border-radius: 50%;   }   .btn-round-blink:before{     animation: round-blink 2s infinite;   }   .btn-round-blink:after{     animation: round-blink 1s infinite;   }   @keyframes round-blink{     from {       opacity: 1;       transform: scale(1);     }     to {       opacity: 0;       transform: scale(1.88);     }   }   .progress{     position: absolute;     left: -100%;     top: 0;     background-color: #00c1de;     width: 100%;     height: 3px;   }   .progress.fade-in{     animation: fade-in 1s ease-in;   }   @keyframes fade-in{     from {       transform: translate3d(0, 0, 0);     }     to {       transform: translate3d(200%, 0, 0);     }   }   .progress-grow{     position: absolute;     left: 0;     top: 0;     width: 0;     height: 3px;     background-color: #00c1de;     animation: grow-in 1s infinite;   }   @keyframes grow-in{     from {       width: 0;     }     to{       width: 100%;     }   }</style><div class="progress" id="progress"></div><br><div class="container"><br>    <button class="btn" id="btn">显示进度条</button><br></div><br><div class="container"><br>    <button class="btn btn-round-blink"></button><br></div><script>  var btn = document.getElementById('btn')    , progress = document.getElementById('progress')  btn.addEventListener('mouseup', function () {    this.classList.add('btn-blink')  })  btn.addEventListener('animationend', function () {    this.classList.remove('btn-blink')  })  btn.addEventListener('click', function () {    progress.classList.add('fade-in')  })  progress.addEventListener('animationend', function () {    progress.classList.remove('fade-in')  })</script><blockquote><p>本篇主要内容是如何自己实现各种网站，UI框架的一些过渡效果</p></blockquote><h2 id="按钮"><a href="#按钮" class="headerlink" title="按钮"></a>按钮</h2><blockquote><p>之前看到<a href="https://ant.design/components/button-cn/" target="_blank" rel="external">ant design</a>上按钮的那种点击效果，于是按照自己的思路来模拟下。</p></blockquote><p>这种效果其实有多种实现方式，我们这里提供一种:</p><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line">// 按钮的样式</div><div class="line">.btn&#123;</div><div class="line">  position: relative;</div><div class="line">  display: inline-block;</div><div class="line">  box-sizing: border-box;</div><div class="line">  outline: none;</div><div class="line">  border: 1px solid #ebebeb;</div><div class="line">  padding: 0 15px;</div><div class="line">  height: 30px;</div><div class="line">  line-height: 30px;</div><div class="line">  border-radius: 4px;</div><div class="line">  user-select: none;</div><div class="line">  cursor: pointer;</div><div class="line">  text-align: center;</div><div class="line">  color: #fff;</div><div class="line">  background-color: #00c1de;</div><div class="line">&#125;</div><div class="line">// 一闪而过的矩形</div><div class="line">.btn.btn-blink:after&#123;</div><div class="line">  position: absolute;</div><div class="line">  content: "";</div><div class="line">  top: -1px;</div><div class="line">  left: -1px;</div><div class="line">  bottom: -1px;</div><div class="line">  right: -1px;</div><div class="line">  border: 1px solid #00c1de;</div><div class="line">  border-radius: inherit;</div><div class="line">  box-shadow: 0 0 2px 0 #00c1de;</div><div class="line">  // 合理执行时间和缓动函数可以使动画看起来更加的舒适。。。</div><div class="line">  // 所以需要自己慢慢的调试</div><div class="line">  animation: blink .3s cubic-bezier(.645,.045,.355,1);</div><div class="line">&#125;</div><div class="line">// 一闪而过的动画</div><div class="line">@keyframes blink&#123;</div><div class="line">  from &#123;</div><div class="line">    opacity: .5;</div><div class="line">    transform: scale(1);</div><div class="line">  &#125;</div><div class="line">  to &#123;</div><div class="line">    opacity: 0;</div><div class="line">     // y轴的放大应该比x轴大一些，因为一般按钮情况下按钮的宽度都是大于高度的</div><div class="line">     // 如果不这样做，动画就不是很理想了</div><div class="line">    transform: scale3d(1.1, 1.2, 0);</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><h2 id="闪烁效果"><a href="#闪烁效果" class="headerlink" title="闪烁效果"></a>闪烁效果</h2><blockquote><p>这种效果就跟水波一样，一层一层的像远处散开然后消失。<br>最简单的用before和after伪类就可以实现，当然了这也只是一种实现。如果觉得不够逼真，那么就需要你慢慢的调试，改动缓动函数以及动画执行的事件。</p></blockquote><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">.btn&#123;</div><div class="line">    // 同上 </div><div class="line">&#125;</div><div class="line">.btn-round-blink&#123;</div><div class="line">  font-size: 30px;</div><div class="line">  font-weight: 500;</div><div class="line">  margin: 0 30px;</div><div class="line">  height: 30px;</div><div class="line">  width: 30px;</div><div class="line">  border-radius: 50%;</div><div class="line">&#125;</div><div class="line">.btn-round-blink:before,</div><div class="line">.btn-round-blink:after&#123;</div><div class="line">  position: absolute;</div><div class="line">  content: "";</div><div class="line">  top: 0;</div><div class="line">  left: 0;</div><div class="line">  right: 0;</div><div class="line">  bottom: 0;</div><div class="line">  border: 1px solid #00c1de;</div><div class="line">  border-radius: 50%;</div><div class="line">&#125;</div><div class="line">.btn-round-blink:before&#123;</div><div class="line">  animation: round-blink 2s infinite;</div><div class="line">&#125;</div><div class="line">.btn-round-blink:after&#123;</div><div class="line">  animation: round-blink 1s infinite;</div><div class="line">&#125;</div></pre></td></tr></table></figure><h2 id="进度条"><a href="#进度条" class="headerlink" title="进度条"></a>进度条</h2><blockquote><p>进入条一般用在异步请求中。</p></blockquote><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line">// 可以用这种效果</div><div class="line">.progress&#123;</div><div class="line">  position: fixed;</div><div class="line">  left: -100%;</div><div class="line">  top: 0;</div><div class="line">  background-color: #00c1de;</div><div class="line">  width: 100%;</div><div class="line">  height: 3px;</div><div class="line">&#125;</div><div class="line">.progress.fade-in&#123;</div><div class="line">  animation: fade-in 1s ease-in infinite;</div><div class="line">&#125;</div><div class="line">@keyframes fade-in&#123;</div><div class="line">  from &#123;</div><div class="line">    transform: translate3d(0, 0, 0);</div><div class="line">  &#125;</div><div class="line">  to &#123;</div><div class="line">    transform: translate3d(200%, 0, 0);</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">// 也可以用这种效果</div><div class="line">.progress-grow&#123;</div><div class="line">  position: fixed;</div><div class="line">  left: 0;</div><div class="line">  top: 0;</div><div class="line">  width: 0;</div><div class="line">  height: 3px;</div><div class="line">  background-color: #00c1de;</div><div class="line">  animation: grow-in 1s infinite;</div><div class="line">&#125;</div><div class="line">@keyframes grow-in&#123;</div><div class="line">  from &#123;</div><div class="line">    width: 0;</div><div class="line">  &#125;</div><div class="line">  to&#123;</div><div class="line">    width: 100%;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;style type=&quot;text/css&quot; media=&quot;screen&quot;&gt;
   .container{
     margin: 15px auto;
   }
   .btn{
     position: relative;
     display: inline-bl
      
    
    </summary>
    
      <category term="frontend" scheme="https://xxxxxmiss.github.io/categories/frontend/"/>
    
    
      <category term="css" scheme="https://xxxxxmiss.github.io/tags/css/"/>
    
  </entry>
  
  <entry>
    <title>使用hexo搭建自己的博客</title>
    <link href="https://xxxxxmiss.github.io/2017/09/28/create-blog/"/>
    <id>https://xxxxxmiss.github.io/2017/09/28/create-blog/</id>
    <published>2017-09-28T15:17:08.000Z</published>
    <updated>2017-10-11T04:01:41.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h2><ul><li><a href="https://nodejs.org/en/" target="_blank" rel="external">Node</a></li><li><a href="https://github.com/" target="_blank" rel="external">github</a></li><li><a href="https://pages.github.com/" target="_blank" rel="external">git-pages</a></li><li><a href="https://git-scm.com/" target="_blank" rel="external">git</a>或者其他的版本控制工具</li><li><a href="https://github.com/hexojs/hexo" target="_blank" rel="external">Hexo</a>或者其他的SSG</li></ul><h2 id="Hexo相关配置"><a href="#Hexo相关配置" class="headerlink" title="Hexo相关配置"></a>Hexo相关配置</h2><blockquote><p><a href="https://hexo.io/" target="_blank" rel="external">Hexo</a></p></blockquote><h3 id="几个主要命令"><a href="#几个主要命令" class="headerlink" title="几个主要命令"></a>几个主要命令</h3><ul><li>hexo new post/draft &lt;file-name&gt;</li></ul><blockquote><p>会在source目录下的_posts或则_drafts下生成file-name.md。<br>也就是说你在使用<code>hexo new</code>创建文件的时候，不需要带文件扩展名，默认生成markdown文件</p></blockquote><ul><li>hexo clean</li></ul><blockquote><p>清楚缓存，一般在使用<code>hexo deploy</code>命令时，先执行该命令。</p></blockquote><ul><li>hexo deploy</li></ul><blockquote><p>推送到仓库到远程</p></blockquote><p>当然，你也可以加入自己的逻辑，用脚本将这些命令串起来，这样在发布以及提交源代码的时候就可以一步到位：比如<a href="https://github.com/xxxxxMiss/xxxxxMiss.github.io/blob/gh-pages/deploy.sh" target="_blank" rel="external">像这样</a></p><h2 id="markdown语法"><a href="#markdown语法" class="headerlink" title="markdown语法"></a>markdown语法</h2><blockquote><p>github上常用markdown语法：<a href="https://guides.github.com/features/mastering-markdown/" target="_blank" rel="external">Mastering Markdown</a><br>简体中文版：<a href="http://www.appinn.com/markdown/" target="_blank" rel="external">markdown</a></p></blockquote><p>注意：</p><ul><li>在hexo中使用markdown时，引用外部资源的时候，需要按照hexo提供的语法来引用。<br>比如引用图片：<figure class="highlight django"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="xml"></span><span class="template-tag">&#123;% <span class="name">asset_img</span> stacking-props.png 其他属性的元素 %&#125;</span><span class="xml"></span></div></pre></td></tr></table></figure></li></ul><p>上面的<code></code>是固定语法，<code>stacking-props.png</code>是对应的资源文件，<code>其他属性的元素</code>是鼠标hover时候显示的字符。当然了，你也可以不传该参数，那么hover的时候就显示<code>stacking-props.png</code></p><ul><li>按照上一步引用资源，需要在<code>_config.yml</code>中将<code>post_asset_folder</code>选项设置为<code>true</code>。一旦开启该选项，那么在每次使用<code>hexo new</code>创建文章的时候，都会在对于的目录下生成和文件名相同的目录，你的静态资源就放到该目录下。</li></ul><p>比如：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo new post hexo-blog</div></pre></td></tr></table></figure></p><p>那么在<code>source/_posts</code>下就会生成<code>hexo-blog.md</code>文件和<code>hexo-blog</code>文件夹。</p><ul><li>markdown中的一些特殊字符需要转义<br>比如：<code>&lt;</code>需要写成<code>&amp;lt;</code></li></ul><p>更多选项参考<a href="https://hexo.io/docs/asset-folders.html" target="_blank" rel="external">官方文档这里</a></p><h2 id="yaml语法"><a href="#yaml语法" class="headerlink" title="yaml语法"></a>yaml语法</h2><blockquote><p><a href="http://www.ruanyifeng.com/blog/2016/07/yaml.html?f=tt" target="_blank" rel="external">yaml</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;环境&quot;&gt;&lt;a href=&quot;#环境&quot; class=&quot;headerlink&quot; title=&quot;环境&quot;&gt;&lt;/a&gt;环境&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://nodejs.org/en/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;
      
    
    </summary>
    
    
      <category term="js" scheme="https://xxxxxmiss.github.io/tags/js/"/>
    
      <category term="frontend-framework" scheme="https://xxxxxmiss.github.io/tags/frontend-framework/"/>
    
  </entry>
  
</feed>
